!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.BoxArt=t():e.BoxArt=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=30)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a,o=2,i=(a={},a.BEFORE_ITEMS=0,a.AFTER_ITEMS=1,a.ITEMS=2,a.ANIMATE=3,a.DESTROY=4,a),s=function(e,t){var n=e._state,r=e._state;0===r&&1===t||3===r&&3===t?r=o:0===r&&2===t||3===r&&0===t?r=1:1===r&&1===t||r===o&&2===t?r=3:(1===r&&3===t||r===o&&0===t)&&(r=0),r!==n&&(e._state=r,3===n?e.cancelFrame():3===r&&(e.last=e.now(),e._frameId=e.requestFrame()))},u=function(e){var t=e[0],n=e[1],r=e[2];this.remove(t,n),this.remove(this._remove,e,r)},c=function(){this._soon=null},l=function(e){e.requestFrame();for(var t=e.cleanup,n=void 0,r=void 0,a=void 0,o=0,i=t.length;o<i;o+=2){n=t[o+0],r=t[o+1];for(var u=e.stages,c=Array.isArray(u),l=0,u=c?u:u[Symbol.iterator]();;){var f;if(c){if(l>=u.length)break;f=u[l++]}else{if(l=u.next(),l.done)break;f=l.value}var p=f;if("break"===function(t){if(-1!==(a=t.findIndex(function(e,a){return a%2==0&&e===n&&t[a+1]===r})))return t.splice(a,2),e.itemCount-=1,"break"}(p))break}}if(t.length=0,0===e.itemCount)return void s(e,3);var d=e.now(),m=Math.min((d-e.last)/1e3,.033);e.last=d;for(var h=e.stages,v=Array.isArray(h),x=0,h=v?h:h[Symbol.iterator]();;){var y;if(v){if(x>=h.length)break;y=h[x++]}else{if(x=h.next(),x.done)break;y=x.value}for(var g=y,b=0;b<g.length;b+=2)try{g[b+0](g[b+1],m)}catch(e){console.error(e?e.stack||e:e)}}},f=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=n.requestFrame,i=void 0===a?window.requestAnimationFrame:a,s=n.cancelFrame,f=void 0===s?window.cancelAnimationFrame:s,p=n.now,d=void 0===p?Date.now:p;r(this,e),this._state=o,this.itemCount=0,this.stages=[[],[],[],[],[]],this.cleanup=[],this._remove=u.bind(this),this._soonNull=c.bind(this),this.requestFrame=function(){t._frameId=i.call(null,function(){return l(t)})},this.cancelFrame=function(){f.call(null,t._frameId)},this.now=d}return e.prototype.pause=function(){s(this,0)},e.prototype.resume=function(){s(this,1)},e.prototype.add=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ANIMATE";0===this.itemCount&&s(this,2),this.itemCount+=1,this.stages[i[n]].push(e,t)},e.prototype.remove=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cleanup.push(e,t)},e.prototype.schedule=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"BEFORE_ITEMS";this.add(e,t,n)},e.prototype.unschedule=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.remove(e,t)},e.prototype.once=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"BEFORE_ITEMS";this.add(e,t,n),this.add(this._remove,[e,t,n],n)},e.prototype.soon=function(){return this._soon||(this._soon=Promise.resolve().then(this._soonNull)),this._soon},e}();f.stages={BEFORE_ITEMS:"BEFORE_ITEMS",AFTER_ITEMS:"AFTER_ITEMS",ITEMS:"ITEMS",ANIMATE:"ANIMATE",DESTROY:"DESTROY"},"function"==typeof requestAnimationFrame?f.main=new f:f.main=new f({requestFrame:function(e){return setTimeout(e,16)},cancelFrame:function(e){return clearTimeout(e)}}),t.a=f},function(e,t){var n=function(e){return{op:"literal",value:e}},r=n,a=function(e,t){return{op:"write",name:e,value:t}},o=a,i=function(e){return{op:"read",name:e}},s=i,u=function(e,t,n){return{op:"store",ref:e,member:t,value:n}},c=u,l=function(e,t){return{op:"load",ref:e,member:t}},f=l,p=function(e,t){return{op:"unary",operator:e,right:t}},d=function(e,t,n){return{op:"binary",operator:e,left:t,right:n}},m=function(e,t){return d("==",e,t)},h=function(e,t){return d("!=",e,t)},v=function(e,t){return d("<",e,t)},x=function(e,t){return d("<=",e,t)},y=function(e,t){return d(">",e,t)},g=function(e,t){return d(">=",e,t)},b=function(e,t){return d("&&",e,t)},k=function(e,t){return d("||",e,t)},_=function(e,t){return d("+",e,t)},w=function(e,t){return d("-",e,t)},O=function(e,t){return d("*",e,t)},E=function(e,t){return d("/",e,t)},A=function(e,t){return d("%",e,t)},S=function(e,t){return d("min",e,t)},j=function(e,t){return d("max",e,t)},T=function(e){return p("abs",e)},N=function(e){return{op:"body",body:e}},q=function(e,t,n){return{op:"for_of",iterable:e,keys:t,body:N(n)}},M=function(e,t){return{op:"not_last",last:t,not_last:e}},R=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{op:"branch",test:e,body:N(t),else:N(n)}},I=function(e,t){return{op:"loop",test:e,body:N(t)}},F=function(e,t){return{op:"call",func:e,args:t}},C=function(e,t){return{op:"func",args:e,body:N(t)}},J=function(e){return{op:"methods",methods:e}};e.exports={literal:n,l:r,write:a,w:o,read:i,r:s,store:u,st:c,load:l,lo:f,unary:p,binary:d,eq:m,ne:h,lt:v,lte:x,gt:y,gte:g,and:b,or:k,add:_,sub:w,mul:O,div:E,mod:A,min:S,max:j,abs:T,body:N,for_of:q,not_last:M,branch:R,loop:I,call:F,func:C,methods:J}},function(e,t,n){var r=n(15),a=n(16),o=n(18),i=function e(t){function n(e){return Object.setPrototypeOf(e,n.prototype)}function i(e){return Object.setPrototypeOf(e,i.prototype)}function s(e){if("func"!==e.op&&"methods"!==e.op)return e;try{var t=Object.assign(function(){return e._compiled=e._compiled||r(e)(),e._compiled.apply(e,arguments)},e,{definition:e});return"methods"===e.op&&e.methods.main&&Object.keys(e.methods).filter(function(e){return"main"!==e}).forEach(function(n){t[n]=function(){var t;return e._compiled=e._compiled||r(e)(),(t=e._compiled)[n].apply(t,arguments)}}),t}catch(t){return console.error(t),e}}var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.prototype=Object.create(Function.prototype),n.prototype.constructor=n,n.prototype.asfunc=function(e){return r(this,e)},i.prototype=Object.create(Object.prototype),i.prototype.constructor=i,i.prototype.compile=function(e){return r(this,e)},i.prototype.run=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.apply(void 0,[this,e].concat(n))};var c={},l=Object.create(u);Object.defineProperties(l,{create:{enumerable:!1,value:function(t,n){return"function"==typeof t?e(function(){return Object.assign({},c,t())},n):e(Object.assign({},c,t),n)}},funcRegistry:{enumerable:!1,value:function(e){var t={};return Object.entries(l).forEach(function(n){var r=n[0],a=n[1];t[r]=a.asfunc(e)}),a(t)}},register:{enumerable:!1,value:function(e,t,r){return"function"==typeof t&&(r=t,t=void 0),t&&(r.args=t),c[e]=r,l[e]=new n(function(){for(var e,t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach(function(e){Object.getPrototypeOf(e)===i.prototype&&Object.setPrototypeOf(e,Object.prototype)}),new i(s((e=r).call.apply(e,[this].concat(n))))}),l[e].args=t,n.prototype[e]=new n(function(){for(var e,t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach(function(e){Object.getPrototypeOf(e)===i.prototype&&Object.setPrototypeOf(e,Object.prototype)}),new i(s((e=r).call.apply(e,[this,this].concat(n))))}),n.prototype.args=t,i.prototype[e]=new n(function(){for(var e,t=arguments.length,n=Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach(function(e){Object.getPrototypeOf(e)===i.prototype&&Object.setPrototypeOf(e,Object.prototype)}),new i(s((e=r).call.apply(e,[this,this].concat(n))))}),l[e]}},cast:{enumerable:!1,value:function(e){return new n(function(){return new n(e.bind())()})}},context:{enumerable:!1,value:function(e){return e(l)}},freeze:{enumerable:!1,value:function(){return Object.freeze(c),Object.freeze(l),Object.freeze(n.prototype),Object.freeze(i.prototype),l}}});var f=t;"function"==typeof t&&(f=t());for(var p in f)l.register(p,f[p].args,f[p]);return l};e.exports=i,e.exports.create=i},function(e,t,n){var r=n(1),a=n(2),o=a(r),i=o.context(function(e){var t=e.func,n=e.call,r=(e.lo,e.l,e.r);return function(e){return function(a,o,i,s){var u=function(r){return a(t(i,[e(n(o(r),s))]))};return u.args=[["x"],r("x")],u}}}),s=o.context(function(e){var t=e.func,n=e.call,r=(e.lo,e.l,e.r);return function(e){return function(a,o,i,s){var u=function(r,u){return a(t(i,[e(n(o(r),s),n(o(u),s))]))};return u.args=[["x","y"],r("x"),r("y")],u}}}),u=o.context(function(e){return[e.abs].map(i)}),c=u[0],l=o.context(function(e){return[e.add,e.sub,e.mul,e.div,e.mod,e.min,e.max,e.eq,e.ne,e.lt,e.lte,e.gt,e.gte].map(s)}),f=l[0],p=l[1],d=l[2],m=l[3],h=l[4],v=l[5],x=l[6],y=l[7],g=l[8],b=l[9],k=l[10],_=l[11],w=l[12];e.exports={abs:c,add:f,sub:p,mul:d,div:m,mod:h,min:v,max:x,eq:y,ne:g,lt:b,lte:k,gt:_,gte:w}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(0),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.a.main;r(this,e),this.factory=t,this.loop=n,this.states={},this.elementToId=new Map}return e.prototype.get=function(e,t){var n=this.states[t];return n||(n=this.states[t]=this.factory(e)),n},e.prototype.set=function(e,t,n){var r=this.get(e,t);return r.set(n||"default"),r},e.prototype.delete=function(e,t){this.states[t]&&(this.states[t].unschedule(),this.states[t]=null)},e.prototype.setElement=function(e,t,n){var r=this.get(e,t);if(r){this.elementToId.set(n,t);var a=r.data.animated||{root:{element:null}};a.root.element=n,r.schedule(a,this.loop)}},e.prototype.getAnimatedState=function(e){this.states[this.elementToId.get(e)]},e.prototype.getAnimated=function(e){var t=this.getAnimatedState(e);return t&&t.data.animated},e}();t.a=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(6),o=function(){function e(t){r(this,e),this.animations=t,this.create=this.create.bind(this)}return e.prototype.create=function(e){return new a.a(this.animations[e])},e}();t.a=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(e,t){return t};a.copy=function(e){return e};var o=function(){};o.eq=function(){return!0};var i=function(){};i.store=function(){},i.restore=function(){};var s={update:a,animate:o,present:i},u=function(){},c=0,l="__init__",f=function(e){e.loop.soon().then(function(){return d(e,3)})},p=function(e){e.loop.soon().then(function(){return m(e,0)})},d=function(e,t){var n=e.transitionState,r=0;if((3===n||7===n)&&3===t){3===n&&(e.animation={});var u=e.get()||"default",l=e.animations.default||s,d=e.animations[u]||l,h=e.animation.update=d.update||l.update||a;e.animation.animate=d.animate||l.animate||o;var v=e.animation.present=d.present||l.present||i,x=e.data,y=x.animated.root;return x.lastT=x.t,x.t=0,x.end=h(y.element,x.end,x),console.log(JSON.stringify(x.end,null,"  ")),3===e.transitionState&&(x.state=h.copy(x.state,x.end),x.begin=h.copy(x.begin,x.end)),x.store=v.store(x.store,y.element,x),e.loop.add(m,e),e.transitionState=8,void p(e)}if(n===c)0===t?n=1:1===t&&(n=2);else if(1===n)1===t&&(r=2,n=3);else if(2===n)0===t?(r=2,n=3):2===t&&(n=c);else if(4===n)0===t?n=5:1===t&&(n=6);else if(5===n)0===t?r=1:1===t&&(r=2,n=7);else if(6===n)0===t?(r=2,n=7):2===t&&(n=4);else if(7===n)0===t?r=1:2===t&&(n=5);else if(8===n){if(0===t||4===t||2===t){2!==t&&e.resolve();var g=e.data;e.animation.present.restore(g.animated.root.element,g.store,g),e.animation.update.copy(g.begin,g.state),e.loop.remove(m,e)}0===t?(r=2,n=7):2===t?n=5:4===t&&(n=6)}0!==r&&(1===r?e.resolve():2===r&&f(e)),n!==e.transitionState&&(e.transitionState=n)},m=function(e,t){if(8===e.transitionState){var n=e.data,r=e.animation,a=r.animate,o=r.present;n.t+=t,a(n.t,n.state,n.begin,n.end),a.eq&&a.eq(n.t,n.state,n.begin,n.end)?d(e,4):o(n.animated.root.element,n.state,n)}},h=function(){function e(t){r(this,e),this.state=l,this.transitionState=c,this.animation=null,this.animations=t,this.data={t:0,lastT:0,store:null,state:null,begin:null,end:null,animated:null},this.resolve=u}return e.prototype.get=function(){return this.state},e.prototype.set=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u;this.state=e,d(this,0),this.resolve=n},e.prototype.setThen=function(e){var t=this;return new Promise(function(n){return t.set(e,null,n)})},e.prototype.schedule=function(e,t){this.data.animated=e,this.loop=t,d(this,1)},e.prototype.unschedule=function(){d(this,2),this.data.animated=null},e.prototype.transitionStep=function(e){d(this,e)},e.prototype.step=function(e){m(this,e)},e}();t.a=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(){r(this,e),this.set=[]}return e.prototype.values=function(){return this.set},e.prototype.add=function(e){this.set.push(e)},e.prototype.delete=function(e){var t=this.set.indexOf(e);-1!==t&&this.set.splice(t,1)},e}(),o=function(){function e(){r(this,e),this.bound={},this.sets={}}return e.prototype.setFor=function(e,t){return this.sets[e]=this.sets[e]||{},"*"===t?this.sets[e].__all__=this.sets[e].__all__||new a:this.sets[e][t]=this.sets[e][t]||new a},e.prototype.bind=function(e,t){if(!this.bound[e]){var n=e.split(":"),r=n[0],a=n[1],o=this.setFor(r,"*"),i=this.setFor(r,a);if(3===t){var s=o.values(),u=i.values();this.bound[e]=function(e,t,n){for(var r=0,o=s.length;r<o;)s[r++](a,e,t,n);for(var i=0,c=u.length;i<c;)u[i++](e,t,n)}}else this.bound[e]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=o.values(),s=Array.isArray(r),u=0,r=s?r:r[Symbol.iterator]();;){var c;if(s){if(u>=r.length)break;c=r[u++]}else{if(u=r.next(),u.done)break;c=u.value}c.apply(void 0,[a].concat(t))}for(var l=i.values(),f=Array.isArray(l),p=0,l=f?l:l[Symbol.iterator]();;){var d;if(f){if(p>=l.length)break;d=l[p++]}else{if(p=l.next(),p.done)break;d=p.value}d.apply(void 0,t)}}}return this.bound[e]},e.prototype.on=function(e,t){var n=e.split(":"),r=n[0],a=n[1],o=this.setFor(r,a);return o.add(t),function(){return o.delete(t)}},e}();t.a=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(t,n){r(this,e),this.manager=t,this.bus=n,this.stateBegin=n.bind("state:begin",3),this.stateEnd=n.bind("state:end",3),n.on("state:change",this.set.bind(this)),n.on("state:destroy",t.delete.bind(t)),n.on("element:create",t.setElement.bind(t)),n.on("element:update",t.setElement.bind(t)),n.on("element:destroy",t.delete.bind(t))}return e.prototype.set=function(e,t,n){var r=this,a=this.manager.set(e,t,n);this.stateBegin(e,t,n),a.resolve=function(){return r.stateEnd(e,t,n)}},e}();t.a=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(10),o=function(){function e(){r(this,e),this.patterns=new a,this.results={},this.idToTypes={},this._match={last:"",type:"",id:"",animation:""}}return e.prototype.add=function(e,t){var n=e.split(" "),r=n[0],o=n[1];o?(o=o.replace("{type}",r).replace("{id}","*"),-1===o.indexOf("*")&&(o+="*")):o=r+"*",this.patterns.add(r),this.patterns.add(o),this.idToTypes[o]=r;var i={id:(new a).add(o),animationNames:t,hasAnimation:{},animations:new a};t.forEach(function(e){i.animations.add(e.replace("{type}",r)),i.hasAnimation[e]=!0}),i.animations.add(o),this.results[r]=i},e.prototype.match=function(e){if(this._match.last===e)return Boolean(this.results[this._match.type]);this._match.last=e;var t=this._match.type=this.patterns.search(e);if(!t)return!1;var n=void 0,r=this.patterns.begin,a=this.patterns.end;t&&t.endsWith("*")&&(n=e.substring(r,a),t=this.idToTypes[t]);var o=this.results[t],i=o.animations.search(e,a);return i?i.endsWith("*")?(n=e.substring(o.animations.begin,o.animations.end),(i=o.animations.search(e,o.animations.end))||(i=o.animations.search(e,0,r))):n||(o.id.search(e,o.animations.end)?n=e.substring(o.id.begin,o.id.end):o.id.search(e,0,r)&&(n=e.substring(o.id.begin,o.id.end))):(i=o.animations.search(e,0,r),i?i.endsWith("*")?(n=e.substring(o.animations.begin,o.animations.end),i=o.animations.search(e,o.animations.end,r)):n||o.id.search(e,o.animations.end,r)&&(n=e.substring(o.id.begin,o.id.end)):n||o.id.search(e,0,r)&&(n=e.substring(o.id.begin,o.id.end))),this._match.type=t,this._match.animation=i||"default",this._match.id=n||t,!0},e.prototype.matchType=function(){return this._match.type},e.prototype.matchAnimation=function(){return this._match.animation},e.prototype.matchId=function(){return this._match.id},e.prototype.matchHasAnimation=function(e){return this.results[this.matchType()].hasAnimation[e]||!1},e}();t.a=o},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){n(this,e),this.patterns=[],this._dirty=!0,this.code=[],this.answers=[]}return e.prototype.add=function(e){return this.patterns.push({pattern:e,chars:e+"\0",codes:(e+"\0").split("").map(function(e){return e.charCodeAt(0)})}),this._dirty=!0,this},e.prototype.rebuild=function(){for(var e={},t=[],n=[],r=0;r<this.patterns.length;r++){for(var a=this.patterns[r],o=e,i=0;i<a.codes.length-1;i++){var s=a.codes[i];if(42!==s)o=o[s]=o[s]||{};else for(var u={},c=[[o,Object.keys(o),0]];c.length;){var l=c.pop();o=l[0];var f=l[1],p=l[2];if(p<f.length){var d=o[f[p]];c.push([o,f,p+1]),d.pattern||c.push([d,Object.keys(d),0])}else o=o[42]=u}}o[32]=a,o[0]=a}for(var m=t.length,h=Object.entries(e),v=0;v<h.length;v++)t[m++]=h[v][0],t[m++]=h[v][1];t[m++]=-1,t[m++]=-1;for(var x=0;x<t.length;){var y=t[x+1];if(-1!==y)if(y.pattern)t[x+1]=-n.length,n.push(y.pattern),x+=2;else{t[x+1]=m,h=Object.entries(y),h.sort(function(e,t){var n=e[0],r=t[0];return 42===Number(n)?1:42===Number(r)?-1:Number(n)-Number(r)});for(var g=0;g<h.length;g++)t[m++]=h[g][0],t[m++]=h[g][1];t[m++]=-1,t[m++]=-1,x+=2}else x+=2}this.code=new Int32Array(t),this.answers=n,this._dirty=!1},e.prototype.search=function(e,t,n){if(this._dirty){if(0===this.patterns.length)return!1;this.rebuild()}this.begin=t;for(var r=e+"\0",a=this.code,o=0,i=t||0,s=n||r.length;i<s;++i){var u=r.charCodeAt(i);if(a[o]===u){if(a[o+1]<=0)return this.end=i,this.answers[-a[o+1]];o=a[o+1]}else if(42===a[o]&&32!==u&&0!==u){for(o=a[o+1];++i<s&&32!==(u=r.charCodeAt(i))&&0!==u;);--i}else if(--i,o+=2,-1===a[o]){for(o=0;++i<s&&32!==r.charCodeAt(i););this.begin=i}}return!1},e}();e.exports=r},,,,function(e,t,n){var r=n(1),a=n(2),o=a(r),i=n(3),s=r.r,u=[["fn"],s("fn")],c=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.r,o=e.l,i=(e.read,e.eq);e.w,e.body;return function(e){return t({main:n(["t","state","begin","end"],[r(o(e),[a("t"),a("state"),a("begin"),a("end")])]),a:n(["a","t","state","begin","end"],[r(o(e),[a("t"),a("state"),a("begin"),a("end")])]),eq:n(["t","state","begin","end"],[i(r(o(e),[a("t"),a("state"),a("begin"),a("end")]),r(o(e),[o(1),a("state"),a("begin"),a("end")]))])})}});c.args=u;var l=[["fn","afn"],s("fn"),s("afn")],f=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.r,o=e.l,i=(e.read,e.lo);return function(e,s){return t({main:n(["t","state","begin","end"],[r(o(e),[a("t"),a("state"),a("begin"),a("end")])]),a:n(["a","t","state","begin","end"],[r(o(s),[a("a"),a("t"),a("state"),a("begin"),a("end")])]),eq:n(["t","state","begin","end"],[r(i(o(e),o("eq")),[a("t"),a("state"),a("begin"),a("end")])])})}});f.args=l;var p=[["fn","eqfn"],s("fn"),s("eqfn")],d=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.r,o=e.l,i=(e.read,e.lo);return function(e,s){return t({main:n(["t","state","begin","end"],[r(o(e),[a("t"),a("state"),a("begin"),a("end")])]),a:n(["a","t","state","begin","end"],[r(i(o(e),o("a")),[a("a"),a("t"),a("state"),a("begin"),a("end")])]),eq:n(["t","state","begin","end"],[r(o(s),[a("t"),a("state"),a("begin"),a("end")])])})}});d.args=p;var m=[["fn"],s("fn")],h=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.write,s=e.add,u=e.mul,c=e.sub,l=e.min,f=e.gte;return function(e){return t({main:n(["t","state","begin","end"],[r(a(e),[o("t"),o("state"),o("begin"),o("end")])]),a:n(["a","t","state","begin","end"],[i("b",r(a(e),[o("t"),o("state"),o("begin"),o("end")])),i("e",r(o("a"),[o("t"),o("state"),o("begin"),o("end")])),s(u(c(o("e"),o("b")),l(a(1),o("t"))),o("b"))]),eq:n(["t","state","begin","end"],[f(o("t"),a(1))])})}});h.args=m;var v=[["set"],s("set")],x=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.call,o=e.r,i=e.lo,s=e.w,u=e.l,c=e.branch,l=e.and;return function(e){return t({main:n(["t","state","begin","end"],[r(e,["key","value"],[a(o("value"),[o("t"),o("state"),o("begin"),o("end")])]),o("state")]),set:t(e),a:n(["a","t","state","begin","end"],[r(e,["key","value"],[a(i(o("value"),u("a")),[i(i(o("a"),u("set")),o("key")),o("t"),o("state"),o("begin"),o("end")])]),o("state")]),eq:n(["t","state","begin","end"],[s("result",u(!0)),r(e,["key","value"],[c(l(o("result"),a(i(o("value"),u("eq")),[o("t"),o("state"),o("begin"),o("end")])),[s("result",u(!1))])]),o("result")])})}});x.args=v;var y=["abs","add","sub","mul","div","mod","min","max","eq","ne","lt","lte","gt","gte"].map(o.context(function(e){var t=e.l,n=e.r;return function(e){return i[e](h,function(e){return t(e)},["t","state","begin","end"],[n("t"),n("state"),n("begin"),n("end")])}})),g=y[0],b=y[1],k=y[2],_=y[3],w=y[4],O=y[5],E=y[6],A=y[7],S=y[8],j=y[9],T=y[10],N=y[11],q=y[12],M=y[13],R=[["c"],s("c")],I=o.context(function(e){var t=e.func,n=e.l;return function(e){return h(t([],[n(e)]))}});I.args=R;var F=[[]],C=o.context(function(e){var t=e.methods,n=e.func,r=e.r,a=e.eq,o=e.l;return function(){return t({main:n(["t","state","begin","end"],[r("t")]),a:n(["a","t","state","begin","end"],[r("t")]),eq:n(["t","state","begin","end"],[a(r("t"),o(1))])})}});C.args=F;var J=[[]],z=o.context(function(e){var t=e.methods,n=e.func,r=e.r,a=e.eq,o=e.l;return function(){return t({main:n(["t","state","begin","end"],[r("state")]),a:n(["a","t","state","begin","end"],[r("state")]),eq:n(["t","state","begin","end"],[a(r("t"),o(1))])})}});z.args=J;var P=[["pos"],s("pos")],B=o.context(function(e){var t=e.func,n=e.l,r=e.r,a=e.add,o=e.mul,i=e.sub;return function(e){return h(t(["t","state","begin","end"],[a(o(i(r("end"),r("begin")),n(e)),r("begin"))]))}});B.args=P;var L=[[]],W=o.context(function(){return function(){return B(0)}});W.args=L;var D=[[]],V=o.context(function(){return function(){return B(1)}});V.args=D;var Y=[["[a, b]"],[s("a"),s("b")]],H=o.context(function(e){var t=e.func,n=e.l,r=e.call,a=e.lo,o=e.r,i=e.methods;return function(e){var s=e[0],u=e[1];return i({main:t(["t","state","begin","end"],[r(a(n(s),n("a")),[n(u),o("t"),o("state"),o("begin"),o("end")])]),a:t(["a","t","state","begin","end"],[r(a(n(s),n("a")),[n(u),o("t"),o("state"),o("begin"),o("end")])]),eq:t(["t","state","begin","end"],[r(a(n(u),n("eq")),[o("t"),o("state"),o("begin"),o("end")])])})}});H.args=Y;var U=[["key","fn"],s("key"),s("fn")],G=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo,s=e.or;return function(e,u){return t({main:n(["t","state","begin","end"],[r(a(u),[o("t"),i(o("state"),a(e)),i(o("begin"),a(e)),i(o("end"),a(e))])]),a:n(["b","t","state","begin","end"],[r(i(a(u),a("a")),[s(i(o("b"),a("a")),o("b")),o("t"),i(o("state"),a(e)),i(o("begin"),a(e)),i(o("end"),a(e))])]),eq:n(["t","state","begin","end"],[r(i(a(u),a("eq")),[o("t"),i(o("state"),a(e)),i(o("begin"),a(e)),i(o("end"),a(e))])])})}});G.args=U;var K=[["k","fn"],s("k"),s("fn")],Q=o.context(function(e){var t=e.methods,n=e.func,r=e.st,a=e.r,o=e.l,i=e.call,s=e.lo,u=e.or;e.body;return function(e,c){return t({main:n(["t","state","begin","end"],[r(a("state"),o(e),i(o(c),[a("t"),a("state"),a("begin"),a("end")])),a("state")]),fn:c,a:n(["b","t","state","begin","end"],[r(a("state"),o(e),i(s(o(c),o("a")),[u(s(a("b"),o("fn")),a("b")),a("t"),a("state"),a("begin"),a("end")])),a("state")]),eq:n(["t","state","begin","end"],[i(s(o(c),o("eq")),[a("t"),a("state"),a("begin"),a("end")])])})}});Q.args=K;var X=[["obj"],s("obj")],Z=o.context(function(e){var t=e.methods,n=e.func,r=e.l,a=e.lo,o=e.for_of,i=e.store,s=e.read,u=e.call,c=e.branch,l=e.literal,f=(e.eq,e.load,e.r),p=e.write,d=e.w,m=e.and;return function(e){return t({main:n(["t","state","begin","end"],[o(e,["key","value"],[i(f("state"),f("key"),u(f("value"),[f("t"),a(f("state"),f("key")),a(f("begin"),f("key")),a(f("end"),f("key"))]))]),s("state")]),o:t(e),a:n(["b","t","state","begin","end"],[o(e,["key","value"],[i(f("state"),f("key"),u(a(f("value"),r("a")),[a(a(f("b"),r("o")),f("key")),f("t"),a(f("state"),f("key")),a(f("begin"),f("key")),a(f("end"),f("key"))]))]),s("state")]),eq:n(["t","state","begin","end"],[p("result",l(!0)),o(e,["key","value"],[c(m(f("result"),u(a(f("value"),r("eq")),[f("t"),a(f("state"),f("key")),a(f("begin"),f("key")),a(f("end"),f("key"))])),[d("result",r(!1))])]),s("result")])})}});Z.args=X;var $=[["fn"],s("fn")],ee=o.context(function(e){var t=e.methods,n=e.func,r=e.w,a=e.l,o=e.loop,i=e.lt,s=e.r,u=e.lo,c=e.call,l=e.branch,f=e.add,p=e.and;return function(e){return t({main:n(["t","state","begin","end"],[r("i",a(0)),o(i(s("i"),u(s("state"),a("length"))),[c(a(e),[s("t"),u(s("state"),s("i")),u(s("begin"),s("i")),u(s("end"),s("i"))]),r("i",f(s("i"),a(1)))]),l(s("i"),[]),s("state")]),fn:e,a:n(["a","t","state","begin","end"],[r("i",a(0)),o(i(s("i"),u(s("state"),a("length"))),[c(u(a(e),a("a")),[u(s("a"),a("fn")),s("t"),u(s("state"),s("i")),u(s("begin"),s("i")),u(s("end"),s("i"))]),r("i",f(s("i"),a(1)))]),l(s("i"),[]),s("state")]),eq:n(["t","state","begin","end"],[r("result",a(!0)),r("i",a(0)),o(i(s("i"),u(s("state"),a("length"))),[l(p(s("result"),c(u(a(e),a("eq")),[s("t"),u(s("state"),s("i")),u(s("begin"),s("i")),u(s("end"),s("i"))])),[r("result",a(!1))]),r("i",f(s("i"),a(1)))]),l(s("i"),[]),s("result")])})}});ee.args=$;var te=[["fn","tfn"],s("fn"),s("tfn")],ne=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo;return function(e,s){return t({main:n(["t","state","begin","end"],[r(a(e),[r(a(s),[o("t"),o("state"),o("begin"),o("end")]),o("state"),o("begin"),o("end")])]),a:n(["a","t","state","begin","end"],[r(i(a(e),a("a")),[o("a"),r(a(s),[o("t"),o("state"),o("begin"),o("end")]),o("state"),o("begin"),o("end")])]),eq:n(["t","state","begin","end"],[r(i(a(e),a("eq")),[r(a(s),[o("t"),o("state"),o("begin"),o("end")]),o("state"),o("begin"),o("end")])])})}});ne.args=te;var re=[["fn"],s("fn")],ae=o.context(function(e){var t=e.func,n=e.mul,r=e.r,a=e.w;return function(e){return ne(e,t(["t"],[a("t",n(n(r("t"),r("t")),r("t"))),r("t")]))}});ae.args=re;var oe=[["fn"],s("fn")],ie=o.context(function(e){var t=e.func,n=e.mul,r=e.r,a=e.sub,o=e.w,i=e.l,s=e.add;return function(e){return ne(e,t(["t"],[o("t",a(r("t"),i(1))),s(n(n(r("t"),r("t")),r("t")),i(1))]))}});ie.args=oe;var se=[["fn"],s("fn")],ue=o.context(function(e){var t=e.func,n=e.mul,r=e.r,a=e.add,o=e.sub,i=e.l,s=e.lt,u=e.branch,c=e.w;return function(e){return ne(e,t(["t"],[c("out",r("t")),u(s(r("t"),i(.5)),[c("out",n(i(4),n(n(r("t"),r("t")),r("t"))))],[c("out",a(n(n(o(r("t"),i(1)),o(n(i(2),r("t")),i(2))),o(n(i(2),r("t")),i(2))),i(1)))]),r("out")]))}});ue.args=se;var ce=o.context(function(e){var t=e.func,n=e.mul,r=e.l,a=e.r;e.w;return t(["x1","x2"],[n(r(3),a("x1"))])}),le=o.context(function(e){var t=e.func,n=e.sub,r=e.mul,a=e.l,o=e.r;return t(["x1","x2"],[(0,e.w)("c",(0,e.call)(ce,[o("x1"),o("x2")])),n(r(a(3),n(o("x2"),o("x1"))),o("c"))])}),fe=o.context(function(e){var t=e.func,n=e.sub,r=e.l,a=(e.mul,e.r),o=e.w,i=e.call;return t(["x1","x2"],[o("c",i(ce,[a("x1"),a("x2")])),o("b",i(le,[a("x1"),a("x2")])),n(n(r(1),a("c")),a("b"))])}),pe=o.context(function(e){var t=e.func,n=e.mul,r=e.r,a=e.add,o=e.call,i=e.w;e.l;return t(["t","x1","x2"],[i("c",o(ce,[r("x1"),r("x2")])),i("b",o(le,[r("x1"),r("x2")])),i("a",o(fe,[r("x1"),r("x2")])),n(r("t"),a(r("c"),n(r("t"),a(r("b"),n(r("t"),r("a"))))))])}),de=o.context(function(e){var t=e.func,n=e.add,r=e.call,a=e.r,o=e.mul,i=e.l,s=e.w;return t(["t","x1","x2"],[s("c",r(ce,[a("x1"),a("x2")])),s("b",r(le,[a("x1"),a("x2")])),s("a",r(fe,[a("x1"),a("x2")])),n(a("c"),o(a("t"),n(o(i(2),a("b")),o(o(i(3),a("a")),a("t")))))])}),me=o.context(function(e){var t=e.func,n=e.w,r=e.r,a=e.l,o=e.call,i=e.loop,s=e.and,u=e.lt,c=e.gte,l=e.abs,f=e.sub,p=e.div,d=e.add,m=e.branch;return t(["t","x1","x2"],[n("x",r("t")),n("i",a(0)),n("z",f(o(pe,[r("x"),r("x1"),r("x2")]),r("t"))),i(s(u(r("i"),a(14)),c(l(r("z")),a(.001))),[n("x",f(r("x"),p(r("z"),o(de,[r("x"),r("x1"),r("x2")])))),n("z",f(o(pe,[r("x"),r("x1"),r("x2")]),r("t"))),n("i",d(r("i"),a(1)))]),m(r("z"),[]),m(r("i"),[]),r("x")])}),he=[["fn","ax","ay","bx","by"],s("fn"),s("ax"),s("ay"),s("bx"),s("by")],ve=o.context(function(e){var t=e.func,n=e.call,r=e.r,a=e.l;e.w,e.methods;return function(e,o,i,s,u){return ne(e,t(["t"],[n(pe,[n(me,[r("t"),a(o),a(s)]),a(i),a(u)])]))}});ve.args=he;var xe=[["fn","duration"],s("fn"),s("duration")],ye=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo,s=e.div,u=e.gte;e.mod;return function(e,c){return t({main:n(["t","state","begin","end"],[r(a(e),[s(o("t"),a(c)),o("state"),o("begin"),o("end")])]),a:n(["a","t","state","begin","end"],[r(i(a(e),a("a")),[o("a"),s(o("t"),a(c)),o("state"),o("begin"),o("end")])]),eq:n(["t","state","begin","end"],[u(s(o("t"),a(c)),a(1))])})}});ye.args=xe;var ge=[["fn","loop"],s("fn"),s("loop")],be=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo,s=(e.div,e.gte),u=e.mod;return function(e,c){return t({main:n(["t","state","begin","end"],[r(a(e),[u(o("t"),a(c)),o("state"),o("begin"),o("end")])]),a:n(["a","t","state","begin","end"],[r(i(a(e),a("a")),[o("a"),u(o("t"),a(c)),o("state"),o("begin"),o("end")])]),eq:n(["t","state","begin","end"],[s(u(o("t"),a(c)),a(1))])})}});be.args=ge;var ke=[["fn","until"],s("fn"),s("until")],_e=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=(e.mod,e.div,e.r),i=e.lo,s=(e.mul,e.gte),u=e.w;return function(e,c){return t({main:n(["t","state","begin","end"],[r(a(e),[o("t"),o("state"),o("begin"),o("end")])]),a:n(["a","t","state","begin","end"],[r(i(a(e),a("a")),[o("a"),o("t"),o("state"),o("begin"),o("end")])]),eq:n(["t","state","begin","end"],[u("cmp",r(a(c),[o("t"),o("state"),o("begin"),o("end")])),s(o("cmp"),a(1))])})}});_e.args=ke;var we=[["a","b"],s("a"),s("b")],Oe=o.context(function(){return function(e,t){return H([e,t])}});Oe.args=we;var Ee=[["frames"],s("frames")],Ae=o.context(function(e){var t=e.methods,n=e.func,r=e.w,a=e.r,o=e.l,i=e.for_of,s=e.lo,u=e.sub,c=e.add,l=e.branch,f=e.call,p=(e.not_last,e.lt,e.gte),d=e.lte,m=e.min,h=e.max,v=e.gt,x=e.and,y=e.or,g=e.mul;return function(e){return t({main:n(["t","state","begin","end"],[r("sum",f(o(n(["frames"],[r("s",o(0)),i(e,["_","value"],[r("s",c(a("s"),f(s(a("value"),o("t")),[])))]),a("s")])),[a("frames")])),r("out",a("state")),r("t",h(m(g(a("t"),a("sum")),a("sum")),o(0))),i(e,["_","value"],[l(x(v(a("_for_of_index"),o(0)),d(a("t"),o(0))),[r("out",f(s(s(o(e),u(a("_for_of_index"),o(1))),o("a")),[a("value"),c(a("t"),f(s(s(o(e),u(a("_for_of_index"),o(1))),o("t")),[])),a("state"),a("begin"),a("end")])),r("t",c(a("t"),o(1/0)))],[r("t",u(a("t"),f(s(a("value"),o("t")),[])))])]),l(a("t"),[]),a("out")]),a:n(["a","t","state","begin","end"],[r("sum",f(o(n(["frames"],[r("s",o(0)),i(e,["_","value"],[r("s",c(a("s"),f(s(a("value"),o("t")),[])))]),a("s")])),[a("frames")])),r("out",a("state")),r("t",h(m(g(a("t"),a("sum")),a("sum")),o(0))),i(e,["_","value"],[r("t",u(a("t"),f(s(a("value"),o("t")),[]))),l(d(a("t"),o(0)),[r("out",f(s(a("value"),o("a")),[y(s(o(e),c(a("_for_of_index"),o(1))),a("a")),c(a("t"),f(s(a("value"),o("t")),[])),a("state"),a("begin"),a("end")])),r("t",c(a("t"),o(1/0)))])]),l(a("t"),[]),a("out")]),eq:n(["t","state","begin","end"],[p(a("t"),o(1))])})}});Ae.args=Ee;var Se=[["timer","fn"],s("timer"),s("fn")],je=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo,s=e.or;return function(e,u){return t({main:n(["t","state","begin","end"],[r(a(u),[r(a(e),[o("t")]),o("state"),o("begin"),o("end")])]),a:n(["a","t","state","begin","end"],[r(i(a(u),a("a")),[s(i(o("a"),a("fn")),o("a")),r(a(e),[o("t")]),o("state"),o("begin"),o("end")])]),fn:u,t:n([],[r(i(a(e),a("t")),[])]),eq:n(["t","state","begin","end"],[r(i(a(u),a("eq")),[r(a(e),[o("t")]),o("state"),o("begin"),o("end")])])})}});je.args=Se;var Te=[["seconds","fn"],s("seconds"),s("fn")],Ne=o.context(function(e){var t=e.methods,n=e.func,r=e.div,a=e.r,o=e.l;return function(e,i){return je(t({main:n(["t"],[r(a("t"),o(e))]),t:n([],[o(e)])}),i)}});Ne.args=Te;var qe=[["ms","fn"],s("ms"),s("fn")],Me=o.context(function(e){var t=e.methods,n=e.func,r=e.div,a=e.r,o=e.l,i=e.w;return function(e,s){return je(t({main:n(["t"],[i("denom",r(o(e),o(1e3))),r(a("t"),a("denom"))]),t:n([],[r(o(e),o(1e3))])}),s)}});Me.args=qe;var Re=[["percent","fn"],s("percent"),s("fn")],Ie=o.context(function(e){var t=e.methods,n=e.func,r=e.div,a=e.r,o=e.l,i=e.w;return function(e,s){return je(t({main:n(["t"],[i("denom",r(o(e),o(100))),r(a("t"),a("denom"))]),t:n([],[r(o(e),o(100))])}),s)}});Ie.args=Re,e.exports=a({value:c,lerp:h,union:x,a:f,done:d,abs:g,add:b,sub:k,mul:_,div:w,mod:O,min:E,max:A,eq:S,ne:j,lt:T,lte:N,gt:q,gte:M,constant:I,t:C,state:z,at:B,begin:W,end:V,fromTo:H,get:G,set:Q,object:Z,array:ee,easing:ne,easeIn:ae,easeOut:ie,easeInOut:ue,bezier:ve,duration:ye,to:Oe,keyframes:Ae,frame:je,seconds:Ne,ms:Me,percent:Ie,until:_e,loop:be})},function(e,t,n){function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("expression"===e.type){n.push(e);for(var r=e.expr.length-1;r>=0;--r){if(i(e.expr[r],t,n))return!0;if(t(e.expr[r],r,e,n))return!0}n.pop()}return!1}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=[];if(e&&"expression"===e.type){n.push(e);for(var a=e.expr.length-1;a>=0;--a){r=r.concat(s(e.expr[a],t,n));var o=t(e.expr[a],a,e,n);o&&(r.push(e.expr[a]),"object"===(void 0===o?"undefined":u(o))&&o.type?e.expr.splice(a,1,o):e.expr.splice(a,1))}n.pop()}return r}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),f=function e(t){o(this,e),Object.assign(this,t)},p=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t.prototype.toString=function(){return this.token},t}(f),d=function(e){function t(){o(this,t);for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];var s=r(this,e.call.apply(e,[this].concat(a)));if("string"!=typeof s.name)throw new Error('assertion: Local "name" must be a string.');return s}return a(t,e),t.prototype.toString=function(){return this.name},t}(f),m=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t.prototype.toString=function(){return"var "+this.local},t}(f),h=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t.prototype.toString=function(){return"var "+this.local.toString()+" = "+this.value.toString()+";"},t}(f),v=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t.prototype.toString=function(){try{return this.expr.join("")}catch(e){return'"bad expression"'}},t}(f),x=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t.prototype.toString=function(){return 0===this.expr.length?"":e.prototype.toString.call(this)+";"},t.prototype.toJSON=function(){return Object.assign({constructor:"Line"},this)},t}(v),y=function(e){function t(n,a,i){return o(this,t),r(this,e.call(this,{type:"expression",expr:[_("("),a,n,i,_(")")]}))}return a(t,e),c(t,[{key:"op",get:function(){return this.expr[2]}},{key:"left",get:function(){return this.expr[1]}},{key:"right",get:function(){return this.expr[3]}}]),t}(v),g=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t.prototype.toString=function(){return this.value},t}(f),b=function(e){function t(){return o(this,t),r(this,e.apply(this,arguments))}return a(t,e),t}(v);b.hasResult=function(e){var t=e.expr;if(!t)return!1;for(var n=t.length-1;n>=0;--n){if(k(t[n]))return!0;if("expression"===t[n].type){if(b.hasResult(t[n]))return!0}}return!1};var k=function(e){return e.expr&&(e instanceof b||e.result)};b.take=function(e){if(!e.expr)return A([e]);if(k(e))return e;for(var t=e.expr.length-1;t>=0;--t){if(k(e.expr[t]))return N(e.expr[t]instanceof b?A(e.expr.splice(t,1)[0].expr):e.expr.splice(t,1)[0]);if("expression"===e.expr[t].type){var n=b.take(e.expr[t]);if(n)return n}}return null},b.taken=function(e){return e.expr?k(e)?A([]):e:A([])};var _=function(e){return new p({type:"token",token:e})},w=function(e){return new d({type:"local",name:e})},O=function(e){return new m({type:"declare",local:e})},E=function(e){return new x({type:"expression",expr:[e]})},A=function(e){return new v({type:"expression",expr:e})},S=function(e,t,n){var r=[],a=t;b.hasResult(t)&&(r=b.taken(t),a=b.take(t));var o=[],i=n;return b.hasResult(n)&&(o=b.taken(n),i=b.take(n)),a!==t||i!==n?A([r,o,T([new y(e,q(a),q(i))])]):new y(e,t,n)},j=function(e){return new g({type:"literal",value:e})},T=function(e){return new b({type:"expression",expr:e})},N=function(e){return e instanceof b?(i(e,function(e){e.result=!1}),A(e.expr)):(i(e,function(e){e.result=!1}),s(e,function(e){return e instanceof b&&A(e.expr)}),e)},q=function(e){return e instanceof x?A(e.expr):(s(e,function(e){return e instanceof x&&A(e.expr)}),e)},M=function(e){if(e.map(b.hasResult).filter(Boolean).length>0){var t=e.map(b.taken).filter(Boolean),n=e.map(b.take).filter(Boolean);return A([].concat(t,[T([].concat(n))]))}return A(e)},R=function(e){var t=e.compile,n=e.pointer,r=e.stack,a=e.scope;if(n.value&&"read"===n.value.op)return B(r,a,n.value.name)[n.value.name]&&"literal"===B(r,a,n.value.name)[n.value.name].op?B(r,a,n.value.name)[n.value.name]:"string"==typeof B(r,a,n.value.name)[n.value.name]?w(B(r,a,n.value.name)[n.value.name]):j(n.value.name);if(n.value&&"func"===n.value.op)return t(n.value);if("string"==typeof n.value)return j(JSON.stringify(n.value));if(Array.isArray(n.value))return A([_("["),_("]")]);if("object"===u(n.value)){Object.entries(n.value);return A([_("{")].concat([_("}")]))}return j(n.value)},I=function(e,t){var n=e.names,r=void 0;return n[t]||(n[t]=[]),r=0===n[t].length?t:"_"+t+n[t].length,n[t].push(r),r},F=function(e,t,n){e.scope[t]=n},C=function(e,t){return e.scope[t]},J=function(e,t){var n=e.locals,r=e.context;return n[t]?C(r,t):I(r,t)},z=function(e){var t=(e.write,e.compile),n=e.pointer,r=e.locals,a=e.scope,o=e.names,i=(e.vars,void 0);if(r[n.name])i=a[n.name];else{o[n.name]||(o[n.name]=[]);var s="_"+n.name+o[n.name].length;o[n.name].push(s),i=s}var u=t(n.value),c=void 0;return c=A(b.hasResult(u)?[b.taken(u),T([O(w(i)),w(i),_(" = "),b.take(u)])]:[O(w(i)),w(i),_(" = "),u]),r[n.name]||(r[n.name]=i,a[n.name]=i),c},P=function(e){for(var t=(e.write,e.compile),n=e.pointer,r=e.scope,a=e.stack,o=r,i=a.length-1;i>=0&&!o[n.name];)o=a[i][1],i-=1;if(o[n.name]&&"literal"===o[n.name].op)return t(o[n.name]);try{return w(o[n.name])}catch(e){throw console.log(n.name,a),e}},B=function(e,t,n){for(var r=t,a=e.length-1;a>=0&&!r[n];)r=e[a][1],a-=1;return r},L=function(e){var t=(e.write,e.compile),n=e.pointer,r=e.stack,a=e.scope,o=t(n.ref),i=n.member,s=void 0;if("literal"===i.op&&i.value.op)s=A([_("["),t(i.value),_("]")]);else if("literal"===i.op)s=A([_("."),j(i.value)]);else if("read"===i.op&&"literal"===B(r,a,i.name)[i.name].op){var u=B(r,a,i.name)[i.name].value;s=A([_("."),j(u)])}else s=A([_("["),t(i),_("]")]);var c=t(n.value),l=A([]),f=o,p=A([]),d=s,m=A([]),h=c;return b.hasResult(o)&&(l=b.taken(o),f=b.take(o)),b.hasResult(s)&&(p=b.taken(s),d=b.take(s)),b.hasResult(c)&&(m=b.taken(c),h=b.take(c)),A(f!==o||d!==s||h!==c?[].concat(l.expr?l.expr:[l],p.expr?p.expr:[p],m.expr?m.expr:[m],[E(q(T([f,d,_(" = "),h])))]):[o,s,_(" = "),c])},W=function(e){var t=(e.write,e.compile),n=e.pointer,r=e.stack,a=e.scope,o=t(n.ref),i=n.member,s=void 0;if("literal"===i.op&&"methods"===i.value)s=A([]);else if("literal"===i.op&&i.value&&"read"===i.value.op&&B(r,a,i.name)[i.name])s=A([_("["),j(B(r,a,i.name)[i.name]),_("]")]);else if("literal"===i.op&&i.value&&"read"===i.value.op)s=A([_("["),t(i),_("]")]);else if("literal"===i.op&&"number"==typeof i.value)s=A([_("["),j(i.value),_("]")]);else if("literal"===i.op)s=A([_("."),j(i.value)]);else if("read"===i.op&&"literal"===B(r,a,i.name)[i.name].op){var u=B(r,a,i.name)[i.name].value;s=A([_("."),j(u)])}else s=A([_("["),t(i),_("]")]);return A(b.hasResult(o)?[b.taken(o),T([b.take(o),s])]:[o,s])},D={"==":function(e,t){return A([_("("),S(_(" == "),e,t),_(")")])},"!=":function(e,t){return M([_("("),e,_(" != "),t,_(")")])},"<":function(e,t){return M([_("("),e,_(" < "),t,_(")")])},"<=":function(e,t){return M([_("("),e,_(" <= "),t,_(")")])},">":function(e,t){return M([_("("),e,_(" > "),t,_(")")])},">=":function(e,t){return M([_("("),e,_(" >= "),t,_(")")])},"&&":function(e,t){return M([_("("),e,_(" && "),t,_(")")])},"||":function(e,t){return M([_("("),e,_(" || "),t,_(")")])},"+":function(e,t){return S(_(" + "),e,t)},"-":function(e,t){return S(_(" - "),e,t)},"*":function(e,t){return S(_(" * "),e,t)},"/":function(e,t){return S(_(" / "),e,t)},"%":function(e,t){return S(_(" % "),e,t)},min:function(e,t){return M([_("Math.min("),e,_(", "),t,_(")")])},max:function(e,t){return M([_("Math.max("),e,_(", "),t,_(")")])},abs:function(e){return M([_("Math.abs("),e,_(")")])}},V=function(e){var t=(e.write,e.compile),n=e.pointer;return D[n.operator](t(n.right))},Y=function(e){var t=(e.write,e.compile),n=e.pointer;return D[n.operator](t(n.left),t(n.right))},H=function(e){var t=e.compile,n=e.pointer,r=e.context,a=e.scope,o=e.locals,i=e.names;if("read"===n.iterable.op){var s="_for_of_index",u=I(r,s),c=o[s],f=a[s];o[s]=u,a[s]=u;var p="_for_of_length",d=I(r,p),m=o[p],h=a[p];o[p]=d,a[p]=d;var v=t(l.w(s,l.l(0))),x=t(l.lt(l.r(s),l.r(p))),y=b.hasResult(v),g=b.hasResult(x),k=A([t(l.body([l.w("constant_entries",l.call(l.l("Object.entries"),[n.iterable]))])),N(A([t(l.w(p,l.lo(l.r("constant_entries"),l.l("length")))),_(";")])),y?b.taken(v):A([]),g?b.taken(x):A([]),A([_("for "),_("(")]),A([y?b.take(v):v,_("; ")]),A([g?b.take(x):x,_("; ")]),A([t(l.r(s)),_("++")]),A([_(") ")]),_("{"),N(t(l.body([n.keys[0]?l.w(n.keys[0],l.lo(l.lo(l.r("constant_entries"),l.r(s)),l.l(0))):l.body([]),l.w(n.keys[1],l.lo(l.lo(l.r("constant_entries"),l.r(s)),l.l(1)))].concat(n.body.body)))),_("}"),T([])]);return i[s].pop(),o[s]=c,a[s]=f,i[p].pop(),o[p]=m,a[p]=h,k}var w="_for_of_index",O=I(r,w),E=o[w],S=a[w];o[w]=O;var j="_for_of_length",q=I(r,j),M=o[j],R=a[j];o[j]=q,a[j]=l.l(Object.entries(n.iterable).length);var F=A([].concat(Object.entries(n.iterable).map(function(e,s){var u=e[0],c=e[1];a[w]=l.l(s);var f=I(r,n.keys[0]),p=o[n.keys[0]],d=a[n.keys[0]],m=I(r,n.keys[1]),h=o[n.keys[0]],v=a[n.keys[0]];o[n.keys[0]]=f,a[n.keys[0]]=l.l(u),o[n.keys[1]]=m,a[n.keys[1]]=c;var x=(t(n.body),N(A([t(n.body)])));return i[n.keys[0]].pop(),o[n.keys[0]]=p,a[n.keys[0]]=d,i[n.keys[1]].pop(),o[n.keys[1]]=h,a[n.keys[1]]=v,x}),[T([])]));return i[w].pop(),o[w]=E,a[w]=S,i[j].pop(),o[j]=M,a[j]=R,F},U=function(e){var t=e.compile,n=e.pointer,r=e.scope;return t(r._for_of_index.op&&"literal"===r._for_of_index.op?r._for_of_index.value<r._for_of_length.value-1?n.not_last:n.last:l.call(l.func([],[l.w("not_last",n.not_last),l.branch(l.gte(l.r("_for_of_index"),l.sub(l.r("_for_of_length"),l.l(1))),[l.w("not_last",n.last)]),l.r("not_last")]),[]))},G=function(e){var t=e.compile,n=e.pointer,r=e.context;if("load"===n.test.op&&X(n.test,r)&&!X(n.test,r).notFound&&~["func","methods"].indexOf(X(n.test,r).op))return t(n.body);if("load"===n.test.op&&X(n.test.ref,r)&&!X(n.test.ref,r).notFound&&~["func","methods"].indexOf(X(n.test.ref,r).op))return t(n.else);var a=t(n.test),o=void 0;return o=A(b.hasResult(a)?[b.taken(a),A([_("if "),_("("),q(b.take(a)),_(") ")]),_("{"),N(t(n.body)),_("}")]:[A([_("if "),_("("),q(a),_(") ")]),_("{"),N(t(n.body)),_("}")]),n.else.body.length?A([o,_("else "),_("{"),N(t(n.else)),_("}")]):o},K=function(e){var t=e.compile,n=e.pointer;return A([_("while ("),t(n.test),_(")"),_("{"),t(n.body),_("}")])},Q=function(e){var t=(e.write,e.compile),n=e.pointer,r=n.body.map(t).filter(Boolean).map(E);return 0===r.length?A([]):1===r.length?b.hasResult(r[0])?A(r):T(r):A(b.hasResult(r[r.length-1])?[].concat(r.slice(0,r.length-1).map(N),[b.taken(r[r.length-1]),T([b.take(r[r.length-1])])]):[].concat(r.slice(0,r.length-1).map(N),[T([r[r.length-1]])]))},X=function e(t,n){if("func"===t.op||"function"==typeof t)return t;if("literal"===t.op&&t.value&&"read"===t.value.op)return t.value;if("literal"===t.op)return t.value;if("binary"===t.op&&"||"===t.operator&&("load"!==t.left.op&&e(t.left,n)&&!e(t.left,n).notFound&&("func"===e(t.left,n).op||"methods"===e(t.left,n).op||"function"==typeof e(t.left,n)||Array.isArray(e(t.left,n)))||"load"===t.left.op&&"load"!==t.left.ref.op&&e(t.left.ref,n)&&!e(t.left.ref,n).notFound&&("func"===e(t.left.ref,n).op||"methods"===e(t.left.ref,n).op||"function"==typeof e(t.left.ref,n)||Array.isArray(e(t.left.ref,n)))||"load"===t.left.op&&"load"===t.left.ref.op&&"load"!==t.left.ref.ref.op&&e(t.left.ref.ref,n)&&!e(t.left.ref.ref,n).notFound("func"===e(t.left.ref.ref,n).op||"methods"===e(t.left.ref.ref,n).op||"function"==typeof e(t.left.ref.ref,n)||Array.isArray(e(t.left.ref.ref,n))))){var r=e(t.left,n);if(r&&!r.notFound)return r;var a=e(t.right,n);return"string"==typeof a?null:a&&!a.notFound?a:null}if("binary"===t.op&&"||"===t.operator)return null;if("binary"===t.op&&"-"===t.operator&&"number"==typeof e(t.left,n)&&"number"==typeof e(t.right,n)){return e(t.left,n)-e(t.right,n)}if("binary"===t.op&&"+"===t.operator&&"number"==typeof e(t.left,n)&&"number"==typeof e(t.right,n)){return e(t.left,n)+e(t.right,n)}if("read"===t.op){if(B(n.stack,n.scope,t.name)[t.name]&&"literal"===B(n.stack,n.scope,t.name)[t.name].op){var o=B(n.stack,n.scope,t.name)[t.name].value;return"string"==typeof o?w(o):o}var i=B(n.stack,n.scope,t.name)[t.name];return"string"==typeof i?w(i):i}if("load"===t.op&&e(t.ref,n)&&("literal"===t.member.op||"number"==typeof e(t.member,n)||"string"==typeof e(t.member,n)||e(t.member,n)&&!e(t.member,n).notFound)){var s=e(t.ref,n);return"literal"===t.member.op&&"methods"===t.member.value?s:("methods"===s.op&&(s=s.methods),"literal"===t.member.op?s[t.member.value]:s[e(t.member,n)])}return"methods"===t.op?t.methods[n.func]:Object.assign(l.func([],[l.l(void 0)]),{notFound:!0})},Z=function(e,t,n){return A(t<n.length-1?[e,_(", ")]:[e])},$=function(e,t,n){return A(t<n.length-1?[e,_(";")]:[e])},ee=function(e){var t=(e.write,e.compile),n=e.pointer,r=e.context,a=X(n.func,r);a&&"methods"===a.op&&(a=a.methods.main);var o=void 0;if(!a||"function"==typeof a||"string"==typeof a||"literal"===a.op&&a.value.op&&"func"!==a.value.op||"literal"===a.op&&!a.value.op||"read"===a.op||"local"===a.type){var i=void 0;i=a?"literal"===a.op&&a.value.op?t(a.value):"literal"===a.op?j(a.value):"read"===a.op&&"literal"!==n.func.op?t(n.func):"read"===a.op?t(a):a.type?a:j(a.toString()):t(n.func);var s=n.args.map(t),u=[],c=[];s.forEach(function(e){b.hasResult(e)?(u.push(b.taken(e)),c.push(b.take(e))):c.push(e)}),o=A(u.length?[].concat(u,[T([_("("),i,_(")(")].concat(c.map(Z),[_(")")]))]):[_("("),i,_(")(")].concat(c.map(Z),[_(")")]))}else"methods"===a.op&&(a=a.methods.main),r.args=n.args.slice(),o=t(a),r.args=null;return o},te=function(e){var t=e.locals,n=e.scope,r=e.context;r.stack.push([t,n]),r.locals={},r.scope={}},ne=function(e){var t=e.context,n=t.stack.pop(),r=n[0],a=n[1];t.locals=r,t.scope=a},re=function(e,t){var n=e.names;t.forEach(function(e){n[e].pop()})},ae=function(e){var t=(e.write,e.compile),n=e.pointer,r=e.context,a=e.lookupScope,o=r.args;if(r.args=null,!o){r.locals,r.scope,r.args;te(r);var i=n.body,u=A([_("function(")].concat(n.args.map(function(e){var t=J(r,e);return F(r,e,t),w(t)}).map(Z),[_(") ")])),c=t(i);c.args=n.args;for(var f=r.options,p=f.passes,d=void 0===p?10:p,m=f.rules,h=void 0===m?Object.keys(ue):m,v=h.concat.apply(h,(f._ruleSets||[]).map(function(e){return ce[e]})).filter(function(e,t,n){return-1===n.indexOf(e,t+1)}),x=0;x<d;++x)for(var y=0;y<v.length;++y)ue[v[y]](c);var g=s(c,function(e){return e&&"declare"===e.type});if(g.length){var k=g.filter(function(e,t){return-1===g.slice(t+1).findIndex(function(t){return e.local.name===t.local.name})}).reduce(function(e,t){return e.expr.push(t.local,_(", ")),e},A([]));k.expr.pop(),c.expr.splice(0,0,A([_("var "),k,_(";")])),c.expr.length>1&&c.expr.splice(1,0,_(" "))}var O=s(c,function(e){return e&&"constant"===e.type});if(O.length&&c.expr.splice(0,0,A(O.map($))),ue.markResults(c),b.hasResult(c)){var S=b.taken(c),j=b.take(c);c=A((S.expr?S.expr:[S]).concat(E(A([_("return "),q(j)]))))}else c.expr&&c.expr.length>0&&(c=A(c.expr.slice(0,c.expr.length-1).concat(E(A([_("return "),c.expr[c.expr.length-1]])))));N(u),N(c);var T=A([u,_("{"),c,_("}")]);return re(r,Object.keys(r.locals)),re(r,n.args),ne(r),T}var M=r.scope;te(r);var R=[];n.args.forEach(function(e,t){var n=void 0;try{n=X(o[t],r)}catch(e){}"literal"===o[t].op&&"read"===o[t].value.op?r.scope[e]=a(o[t].value.name)[o[t].value.name]:"literal"===o[t].op?r.scope[e]=o[t]:"read"===o[t].op?r.scope[e]=M[o[t].name]:n&&!n.notFound?"local"===n.type?r.scope[e]=n.name:r.scope[e]=n:"binary"===o[t].op&&"||"===o[t].operator&&"load"===o[t].left.op&&"literal"===o[t].left.ref.op&&Array.isArray(o[t].left.ref.value)?R.push(l.write(e),o[t].right):R.push(l.write(e,o[t]))});var I=t(l.body(R.concat(n.body.body)));return re(r,Object.keys(r.locals)),ne(r),I},oe=function(e){var t=(e.write,e.compile),n=e.pointer,r=(e.func,e.options);return t(n.methods.op?n.methods:n.methods.main?l.call(l.l(l.func([],[l.w("f",n.methods.main)].concat(Object.keys(n.methods).filter(function(e){return"main"!==e}).filter(function(e){return-1!==(r.methods||Object.keys(n.methods)).indexOf(e)}).map(function(e){return l.st(l.r("f"),l.l(e),n.methods[e])}),[l.r("f")]))),[]):l.call(l.l(l.func([],[l.w("f",l.l({}))].concat(Object.keys(n.methods).map(function(e){return l.st(l.r("f"),l.l(e),n.methods[e])}),[l.r("f")]))),[]))},ie={literal:R,write:z,read:P,store:L,load:W,unary:V,binary:Y,for_of:H,not_last:U,branch:G,loop:K,body:Q,call:ee,func:ae,methods:oe},se=function(e,t){e._pointer.push(e.pointer),e.pointer=t;var n=ie[t.op](e);return e.pointer=e._pointer.pop(),n},ue={markResults:function(e){e.result=e instanceof b,i(e,function(e,t,n,r){e.result=Boolean(r.find(function(e){return e.result||e instanceof b}))||e.result||e instanceof b})},flattenLines:function(e){return s(e,function(e,t,n){return n instanceof x&&1===n.expr.length&&e.expr&&1===e.expr.length&&e.expr[0]}),s(e,function(e,t,n){return e instanceof x&&1===e.expr.length&&e.expr[0].expr&&!i(e.expr[0],function(t,n,r){return r===e.expr[0]&&e instanceof x})&&new x({type:"expression",expr:e.expr[0].expr})}),s(e,function(e,t,n){return e instanceof x&&1===e.expr.length&&e.expr[0].expr&&!e.expr[0].expr.find(function(e){return!(e instanceof x)})&&e.expr[0]}),s(e,function(e,t,n){return e.expr&&!(e instanceof x)&&e.expr.find(function(e){return e instanceof x})&&e.expr.find(function(e){return e.expr&&!(e instanceof x)&&e.expr.find(function(e){return e instanceof x})})&&A(e.expr.reduce(function(e,t){return!t.expr||t instanceof x?e.push(t):e.push.apply(e,t.expr),e},[]))}),s(e,function(e,t,n){return e.expr&&!(e instanceof x)&&1===e.expr.length&&e.expr[0].expr&&!(e.expr[0]instanceof x)&&!e.expr[0].expr.find(function(e){return!(e instanceof x)})&&e.expr[0]}),s(e,function(e){return e instanceof x&&!e.expr.find(function(e){return!e.expr})&&!e.expr.find(function(e){return e instanceof x})&&e.expr.find(function(e){return e.expr.find(function(e){return!e instanceof x})})&&A(e.expr.reduce(function(e,t){return e.push.apply(e,t.expr),e},[]))})},collapseEmpty:function(e){return s(e,function(e,t,n){return e.expr&&0===e.expr.length})},collapse1LenExprAfterWrite:function(e){return s(e,function(e,t,n){return" = "===e.token&&n[t+1]&&n[t+1].expr&&1===n[t+1].expr.length&&n[t+1].expr[0]})},collapseLines:function(e){return s(e,function(e){return e.expr&&1===e.expr.length&&e.expr[0]instanceof x&&e.expr[0]})},collapseExprAroundLocal:function(e){return s(e,function(e){return e.expr&&1===e.expr.length&&e.expr[0].name&&!k(e)&&e.expr[0]})},collapseExprAroundLiteral:function(e){return s(e,function(e){return e.expr&&1===e.expr.length&&"literal"===e.expr[0].type&&!k(e)&&e.expr[0]})},eliminateMul0:function(e){return s(e,function(e){return e.op&&" * "===e.op.token&&(0===e.left.value||0===e.right.value)&&j(0)})},reduceMul1:function(e){return s(e,function(e){return e.op&&" * "===e.op.token&&(1===e.left.value&&e.right||1===e.right.value&&e.left)})},reduceAdd0:function(e){return s(e,function(e){return"expression"===e.type&&e.expr.find(function(e){return" + "===e.token})&&e.expr.find(function(e){return 0===e.value})&&e.expr.find(function(e){return 0!==e.value&&"token"!==e.type})})},reduceOpLiteral:function(e){return s(e,function(e){return"expression"===e.type&&5===e.expr.length&&"literal"===e.expr[1].type&&"literal"===e.expr[3].type&&(" + "===e.expr[2].token&&j(JSON.stringify(JSON.parse(e.expr[1].value)+JSON.parse(e.expr[3].value)))||" - "===e.expr[2].token&&j(JSON.stringify(JSON.parse(e.expr[1].value)-JSON.parse(e.expr[3].value)))||" * "===e.expr[2].token&&j(JSON.stringify(JSON.parse(e.expr[1].value)*JSON.parse(e.expr[3].value)))||" / "===e.expr[2].token&&j(JSON.stringify(JSON.parse(e.expr[1].value)/JSON.parse(e.expr[3].value))))})},emulate:function(e){for(var t,n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o(this,e),this.map={},this.args={},this.parent=t,this.child=null,this.depth=n}return e.prototype.read=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map[e]&&this.map[e][1]&&(this.map[e][1]._read=(this.map[e][1]._read||0)+1),this.parent&&1!==t&&this.parent.read(e,-1),this.child&&-1!==t&&this.child.read(e,1)},e.prototype.get=function(e){return this.map[e]?this.map[e][0]:null},e.prototype.set=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0===r||this.map[e])&&(this.map[e]=[t,n||this.map[e][1]]),this.parent&&1!==r&&this.parent.set(e,null,null,-1),this.child&&-1!==r&&this.child.set(e,null,null,1)},e.prototype._nullAll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;for(var t in this.map)this.map[t]=[null,this.map[t][1]];this.parent&&1!==e&&this.parent._nullAll(-1),this.child&&-1!==e&&this.child._nullAll(1)},e.prototype.isArg=function(e){return!!Boolean(this.args[e])||!!this.parent&&this.parent.isArg(e)},e.prototype.setArg=function(e){this.args[e]=!0},e.prototype.push=function(){if(this.child)for(var t in this.child.map)this.child.map[t][1]._read=(this.child.map[t][1]._read||0)+1,this.child.map[t]=[null,this.child.map[t][1]];else this.child=new e(this,this.depth+1);return this.child},e.prototype.pop=function(){return this.parent},e}(),r=function(){function e(){o(this,e),this.root=this.inner=new n}return e.prototype.read=function(e){this.inner.read(e)},e.prototype.get=function(e){return this.inner.get(e)},e.prototype.set=function(e,t,n){return this.inner.set(e,t,n)},e.prototype.isArg=function(e){return this.inner.isArg(e)},e.prototype.setArg=function(e){this.inner.setArg(e)},e.prototype.push=function(){this.inner=this.inner.push()},e.prototype.pop=function(){this.inner=this.inner.pop()},e}(),a=new r,s=0;e.args&&s<e.args.length;s++)a.setArg(e.args[s]);var u=function e(t,n){if(n.name===t)return!0;if(n.expr)for(var r=0;r<n.expr.length;r++)if(e(t,n.expr[r]))return!0;return!1},c=function(e,t,n){e.name&&(n.expr[t+1]&&" = "!==n.expr[t+1].token||!n.expr[t+1])&&a.read(e.name)},l=function e(t,n,r){if(!t)return!1;if(t.constant)return!1;if(-1!==r.indexOf(t.token)||t.name&&n.isArg(t.name)||void 0!==t.value&&!(t instanceof h)||t.name&&-1!==t.name.indexOf("_arg_constant"))return!0;if(t.expr){for(var a=0;a<t.expr.length;a++)if(!1===e(t.expr[a],n,r))return!1;return!0}return!1},f=function(e,t){return e.expr&&"Math.min("===e.expr[0].token?l(e,t,["Math.min(",", ",")"]):e.expr&&e.expr.find(function(e){return")("===e.token})?l(e,t,["(",")",")(",", "]):l(e,t,["(",")",")("])},p=function e(t,n){var r=0;if(n(t)&&(r+=1),t.expr)for(var a=0;a<t.expr.length;a++)r+=e(t.expr[a],n);return r},d=[],m=p(e,function(e){return e.constant});!function e(t,n,r){if(t){if(c(t,n,r),t.expr)if(t.expr.find(function(e){return"function("===e.token}))for(var o=0;o<t.expr.length;o++)t.expr[o].name&&a.setArg(t.expr[o].name);else for(var s=0;s<t.expr.length;s++)c(t.expr[s],s,t);if("{"===t.token)a.push();else if("}"===t.token)a.pop();else if("local"===t.type)return a.get(t.name)?q(a.get(t.name)):t;if("literal"===t.type)return t;if(t.expr){if(f(t,a)&&p(t,function(e){return!e.name&&!e.expr})&&p(t,function(e){return e.name&&a.isArg(e.name)})){if(d.find(function(e){return String(t)===e[1]})){var l=d.find(function(e){return String(t)===e[1]});return t.expr=[l[0]],l[0]}var h=w("_arg_constant"+m++),v=[h,String(t),E(A([O(h),h,_(" = "),A(t.expr)]))];return i(v[2],function(e){e.constant=!0}),d.push(v),t.expr=[h],h}if(t.expr[0]&&t.expr[0].name&&t.expr[1]&&" = "===t.expr[1].token){var x=e(t.expr[2],2,t);if(a.get(t.expr[0].name)===x)return void(t.expr=[]);if(x&&!u(t.expr[0].name,x)){if(a.get(t.expr[0].name)===x)throw new Error("setting identical value already at variable");t.lastRead=t._read,t.read=0,t._read=0,a.set(t.expr[0].name,x,t)}else t.lastRead=t._read,t.read=0,t._read=0,a.set(t.expr[0].name,null,t)}else if(t.expr[1]&&t.expr[1].name&&t.expr[2]&&" = "===t.expr[2].token){if(0===t._read)return void(t.expr=[]);var y=e(t.expr[3],3,t);if(a.get(t.expr[1].name)===y)return void(t.expr=[]);if(y&&!u(t.expr[1].name,y)){if(a.get(t.expr[1].name)===y)throw new Error("setting identical value already at variable");t.lastRead=t._read,t.read=0,t._read=0,a.set(t.expr[1].name,y,t)}else t.lastRead=t._read,t.read=0,t._read=0,a.set(t.expr[1].name,null,t)}else if(t.expr[2]&&" = "===t.expr[2].token){e(t.expr[0],0,t);var g=e(t.expr[3],3,t);g&&(t.expr[3]=g)}else{if(3===t.expr.length&&"("===t.expr[0].token&&")"===t.expr[2].token)return e(t.expr[1],1,t);if(1===t.expr.length&&"local"===t.expr[0].type)return e(t.expr[0],0,t);if(1===t.expr.length&&"literal"===t.expr[0].type)return t.expr[0];if(1===t.expr.length)return e(t.expr[0],0,t);if(!t.expr[2]||" - "!==t.expr[2].token&&" * "!==t.expr[2].token&&" / "!==t.expr[2].token){if(t.expr[2]&&" + "===t.expr[2].token){var b=void 0,k=void 0;if("expression"===t.expr[1].type){if(t.expr[1]===t)throw new Error("circular expression");if((b=e(t.expr[1],1,t))===t)throw new Error("returned circular expr1");b&&(t.expr[1]=b)}else if("local"===t.expr[1].type&&t.expr[1].name&&a.get(t.expr[1].name)){if((b=e(t.expr[1],1,t))===t)throw new Error("returned circular local1");b&&b!==t&&(t.expr[1]=b)}if("expression"===t.expr[3].type){if((k=e(t.expr[3],3,t))===t)throw new Error("returned circular expr3");k&&(t.expr[3]=k)}else if("local"===t.expr[3].type&&t.expr[3].name&&a.get(t.expr[3].name)){if((k=e(t.expr[3],3,t))===t)throw new Error("returned circular local3");k&&(t.expr[3]=k)}if(t.expr[1]&&"literal"===t.expr[1].type&&t.expr[3]&&"literal"===t.expr[3].type)return j(JSON.stringify(JSON.parse(t.expr[1].value)+JSON.parse(t.expr[3].value)));if(t.expr[1]&&"expression"===t.expr[1].type&&t.expr[3]&&"literal"===t.expr[3].type){if(t.expr[1].expr[2]&&" + "===t.expr[1].expr[2].token&&t.expr[1].expr[3]&&"literal"===t.expr[1].expr[3].type)return A([t.expr[1].expr[0],t.expr[1].expr[1],t.expr[1].expr[2],e(A([t.expr[1].expr[0],t.expr[1].expr[3],t.expr[1].expr[2],t.expr[3],t.expr[1].expr[4]]),3,t.expr[1]),t.expr[1].expr[4]]);if('""'===t.expr[3].value&&t.expr[1])return t.expr[1]}if(t.expr[1]&&"literal"===t.expr[1].type&&t.expr[3]&&"expression"===t.expr[3].type){if(t.expr[3].expr[2]&&" + "===t.expr[3].expr[2].token&&t.expr[3].expr[1]&&"literal"===t.expr[3].expr[1].type)return A([t.expr[3].expr[0],e(A([t.expr[3].expr[0],t.expr[1],t.expr[3].expr[2],t.expr[3].expr[1],t.expr[3].expr[4]]),1,t.expr[3]),t.expr[3].expr[2],t.expr[3].expr[3],t.expr[3].expr[4]]);if('""'===t.expr[1].value&&t.expr[3])return t.expr[3]}return t}if("declare"!==t.type)for(var S=0;S<t.expr.length;S++)try{e(t.expr[S],S,t)}catch(e){throw console.error(String(t.expr[S])),console.error(e.stack||e),e}}else{var T=void 0,N=void 0;if("expression"===t.expr[1].type){if(t.expr[1]===t)throw new Error("circular expression");if((T=e(t.expr[1],1,t))===t)throw new Error("returned circular expr1");T&&(t.expr[1]=T)}else if("local"===t.expr[1].type&&t.expr[1].name&&a.get(t.expr[1].name)){if((T=e(t.expr[1],1,t))===t)throw new Error("returned circular local1");T&&T!==t&&(t.expr[1]=T)}if("expression"===t.expr[3].type){if((N=e(t.expr[3],3,t))===t)throw new Error("returned circular expr3");N&&(t.expr[3]=N)}else if("local"===t.expr[3].type&&t.expr[3].name&&a.get(t.expr[3].name)){if((N=e(t.expr[3],3,t))===t)throw new Error("returned circular local3");N&&(t.expr[3]=N)}if(t.expr[1]&&"literal"===t.expr[1].type&&t.expr[3]&&"literal"===t.expr[3].type){if(" - "===t.expr[2].token)return j(JSON.stringify(JSON.parse(t.expr[1].value)-JSON.parse(t.expr[3].value)));if(" * "===t.expr[2].token)return j(JSON.stringify(JSON.parse(t.expr[1].value)*JSON.parse(t.expr[3].value)));if(" / "===t.expr[2].token)return j(JSON.stringify(JSON.parse(t.expr[1].value)/JSON.parse(t.expr[3].value)))}if(t.expr[1]&&"literal"===t.expr[1].type){if(" * "===t.expr[2].token&&1===JSON.parse(t.expr[1].value))return t.expr[3];if(" * "===t.expr[2].token&&0===JSON.parse(t.expr[1].value))return t.expr[1]}if(t.expr[3]&&"literal"===t.expr[3].type){if(" * "===t.expr[2].token&&1===JSON.parse(t.expr[3].value))return t.expr[1];if(" * "===t.expr[2].token&&0===JSON.parse(t.expr[3].value))return t.expr[3]}}}}}}(e),(t=e.expr).splice.apply(t,[0,0].concat(d.map(function(e){return e[2]})))},eliminateCanceledTerms:function(e){return s(e,function(e){return e.op&&" + "===e.op.token&&e.left.op&&" - "===e.left.op.token&&e.left.right.name===e.right.name&&e.left.left})},collapseParantheses:function(e){return s(e,function(e){return"expression"===e.type&&3===e.expr.length&&"("===e.expr[0].token&&")"===e.expr[2].token&&"expression"===e.expr[1].type&&e.expr[1].expr.length>=3&&"("===e.expr[1].expr[0].token&&")"===e.expr[1].expr[e.expr[1].expr.length-1].token&&A(e.expr[1].expr.slice(1,e.expr[1].expr.length-1))})},combineCommaWithExpr:function(e){return s(e,function(e){return"expression"===e.type&&2===e.expr.length&&"expression"===e.expr[0].type&&", "===e.expr[1].token&&(1===e.expr[0].expr.length&&"expression"===e.expr[0].expr[0].type&&(1===e.expr[0].expr[0].length&&"expression"===e.expr[0].expr[0].expr[0].type&&A(e.expr[0].expr[0].expr[0].expr.concat(_(", ")))||A(e.expr[0].expr[0].expr.concat(_(", "))))||A(e.expr[0].expr.concat(_(", "))))})},replaceMirrorAssignments:function(e){e.depth=0,i(e,function(e,t,n){e.depth=n.depth+1}),s(e,function(t){return"declare"===t.type&&i(e,function(e){return"declare"===e.type&&e.local===t.local&&e.depth<t.depth})}),i(e,function(e,t,n){if(e.expr&&1===e.expr.length&&e.expr[0].expr&&e.expr[0].expr.find(function(e){return"declare"===e.type})){var r=e.expr[0].expr&&e.expr[0].expr.find(function(e){return"declare"===e.type}),a=0;if(i(n,function(e,t,n){e.name===r.local.name&&n.expr[t+1]&&" = "===n.expr[t+1].token&&(a+=1)}),1===a&&4===e.expr[0].expr.length&&"local"===e.expr[0].expr[3].type){var o=e.expr[0].expr[3].name;s(n,function(e){return e.name===r.local.name&&w(o)})}}})},removeEqualAssignments:function(e){return s(e,function(e,t,n){return"expression"===e.type&&(4===e.expr.length&&"local"===e.expr[1].type&&" = "===e.expr[2].token&&"local"===e.expr[3].type&&e.expr[1].name===e.expr[3].name||3===e.expr.length&&"local"===e.expr[0].type&&" = "===e.expr[1].token&&"local"===e.expr[2].type&&e.expr[0].name===e.expr[2].name)})}},ce={symantics:["collapseExpressions","collapseParantheses","combineCommaWithExpr","removeEqualAssignments"],math:["eliminateCanceledTerms","eliminateMul0","reduceAdd0","reduceMul1"],locals:["removeUnusedLocals","replaceMirrorAssignments"]},le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e="function"==typeof e?l.func(e.args[0],[e.apply(void 0,e.args.slice(1))]):l.func([],[e]);var n={_body:"",_pointer:[],pointer:null,stack:[],args:null,scope:{},locals:{},names:{},vars:[],options:t};n.context=n,n.compile=se.bind(null,n),n.lookupScope=function(e){return B(n.stack,n.scope,e)};var r=n.compile(e),a=void 0;try{a=new Function("return "+r.toString()+";")()}catch(e){throw console.log(e.stack||e),console.log(""+r.toString()),e}return a.toAst=function(){return r},a};e.exports=le},function(e,t,n){(function(t){var n=function e(n){function r(e){return Object.setPrototypeOf(e,r.prototype)}var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.prototype=Object.create(Function.prototype),r.prototype.constructor=r;var o={},i=a;Object.defineProperties(a,{create:{enumerable:!1,value:function(t,n){return"function"==typeof t?e(function(){return Object.assign({},o,t())},n):e(Object.assign({},o,t),n)}},register:{enumerable:!1,value:function(e,n){if(o[e]=n,"production"!==t.env.NODE_ENV&&o[e]!==n)throw new Error("Cannot register on a frozen animation builder");return i[e]=new r(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return new r(n.call.apply(n,[this].concat(t)))}),r.prototype[e]=new r(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return new r(n.call.apply(n,[this,this].concat(t)))}),i[e]}},cast:{enumerable:!1,value:function(e){return new r(function(){return new r(e.bind())()})}},context:{enumerable:!1,value:function(e){return e(i)}},freeze:{enumerable:!1,value:function(){return Object.freeze(o),Object.freeze(i),Object.freeze(r.prototype),i}},toString:{enumerable:!1,value:function(){return"{"+Object.entries(o).map(function(e){return e[0]+": "+e[1].toString()}).join(",\n")+"}"}}});var s=n;"function"==typeof n&&(s=n());for(var u in s)i.register(u,s[u]);return i};e.exports=n,e.exports.create=n}).call(t,n(17))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function i(){h&&d&&(h=!1,d.length?m=d.concat(m):v=-1,m.length&&s())}function s(){if(!h){var e=a(i);h=!0;for(var t=m.length;t;){for(d=m,m=[];++v<t;)d&&d[v].run();v=-1,t=m.length}d=null,h=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,f,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var d,m=[],h=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new u(e,t)),1!==m.length||h||a(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){var n=function(e){var t=e.pointer;return JSON.parse(JSON.stringify(t.value))},r=function(e){var t=e.run,n=e.scope,r=e.pointer;return n[r.name]=t(r.value)},a=function(e){return e.scope[e.pointer.name]},o=function(e){var t=e.run,n=e.pointer;return t(n.ref)[t(n.member)]=t(n.value)},i=function(e){var t=e.run,n=e.pointer;return t(n.ref)[t(n.member)]},s={"==":function(e,t){return e==t},"!=":function(e,t){return e!=t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"&&":function(e,t){return e&&t},"||":function(e,t){return e||t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},min:function(e,t){return Math.min(e,t)},max:function(e,t){return Math.max(e,t)}},u=function(e){var t=e.run,n=e.pointer;return s[n.operator](t(n.right))},c=function(e){var t=e.run,n=e.pointer;return s[n.operator](t(n.left),t(n.right))},l=function(e){for(var t=e.run,n=e.scope,r=e.pointer,a=Object.entries(r.iterable),o=void 0,i=a,s=Array.isArray(i),u=0,i=s?i:i[Symbol.iterator]();;){var c;if(s){if(u>=i.length)break;c=i[u++]}else{if(u=i.next(),u.done)break;c=u.value}var l=c;n[r.keys[0]]=l[0],n[r.keys[1]]=l[1],o=t(r.body)}return o},f=function(e){var t=e.run,n=e.pointer;return t(t(n.test)?n.body:n.else)},p=function(e){for(var t=e.run,n=e.pointer,r=void 0,a=n.body,o=Array.isArray(a),i=0,a=o?a:a[Symbol.iterator]();;){var s;if(o){if(i>=a.length)break;s=a[i++]}else{if(i=a.next(),i.done)break;s=i.value}r=t(s)}return r},d=function(e){var t=e.run,n=e.context,r=e.pointer,a=r.func.op?t(r.func):r.func;n.stack.push(n.scope),n.scope=r.args.map(t);var o=t(a);return n.scope=n.stack.pop(),o},m=function(e){var t=e.run,n=e.scope,r=e.pointer,a=e.context;return a.scope={},r.args.forEach(function(e,t){a.scope[e]=n[t]}),t(r.body)},h=function(e){var t=e.run;e.func;return t(e.pointer.methods.main)},v={literal:n,write:r,read:a,store:o,load:i,unary:u,binary:c,for_of:l,branch:f,body:p,call:d,func:m,methods:h},x=function(e,t){e._pointer.push(t),e.pointer=t;var n=void 0;return"function"==typeof t?n=t.apply(void 0,e.scope):t.op&&(n=v[t.op](e)),e._pointer.pop(t),n},y=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o={func:t,_pointer:[],pointer:null,stack:[],scope:r};return o.context=o,o.run=x.bind(null,o),o.run(e)};e.exports=y},function(e,t,n){var r=n(1),a=n(2),o=a(r),i=n(3),s=r.r,u=[["fn"],s("fn")],c=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r;e.or,e.lo,e.w,e.branch;return function(e){return t({main:n(["element","state","animated"],[r(a(e),[o("state"),o("animated")])]),_value:n(["state","animated"],[r(a(e),[o("state"),o("animated")])]),store:n(["state","element"],[o("element")]),restore:n(["element","state"],[o("state")])})}});c.args=u;var l=[["set"],s("set")],f=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.call,o=e.r,i=e.lo,s=e.w,u=e.l;e.branch,e.and;return function(e){return t({main:n(["element","state","animated"],[r(e,["key","value"],[a(o("value"),[o("element"),o("state"),o("animated")])]),o("element")]),store:n(["state","element","animated"],[r(e,["key","value"],[s("state",a(i(o("value"),u("store")),[o("state"),o("element"),o("animated")]))]),o("state")]),restore:n(["element","state","animated"],[r(e,["key","value"],[a(i(o("value"),u("restore")),[o("element"),o("state"),o("animated")])]),o("element")])})}});f.args=l;var p=[["c"],s("c")],d=o.context(function(e){var t=e.func,n=e.l;return function(e){return c(t([],[n(e)]))}});d.args=p;var m=[["key"],s("key")],h=o.context(function(e){var t=e.func,n=e.lo,r=e.r,a=e.l;return function(e){return c(t(["state"],[n(r("state"),a(e))]))}});h.args=m;var v=[["fn","suffix"],s("fn"),s("suffix")],x=o.context(function(e){var t=e.func,n=e.add,r=e.call,a=e.l,o=e.r,i=e.or,s=e.lo;return function(e,u){return c(t(["state","animated"],[n(r(i(s(a(e),a("_value")),a(e)),[o("state"),o("animated")]),a(u))]))}});x.args=v;var y=["em","percent","deg","rad","px","rem","vh","vmax","vmin","vw"].map(function(e){var t=function(t){return x(t,e)};return t.args=[["fn"],s("fn")],t}),g=y[0],b=y[1],k=y[2],_=y[3],w=y[4],O=y[5],E=y[6],A=y[7],S=y[8],j=y[9],T=o.context(function(e){var t=e.func,n=e.call,r=e.lo,a=e.l,o=e.r;return function(e){var i=function(i,s){return c(t(["state","animated"],[e(n(r(a(i),a("_value")),[o("state"),o("animated")]),n(r(a(s),a("_value")),[o("state"),o("animated")]))]))};return i.args=[["a","b"],o("a"),o("b")],i}}),N=o.context(function(e){return[e.add,e.sub,e.mul,e.div].map(T)}),q=N[0],M=N[1],R=N[2],I=N[3],F=["abs","mod","min","max","eq","ne","lt","lte","gt","gte"].map(o.context(function(e){var t=e.l,n=e.r,r=e.lo;return function(e){return i[e](c,function(e){return r(t(e),t("_value"))},["state","animated"],[n("state"),n("animated")])}})),C=F[0],J=F[1],z=F[2],P=F[3],B=F[4],L=F[5],W=F[6],D=F[7],V=F[8],Y=F[9],H=[["fn"],s("fn")],U=o.context(function(e){var t=e.func,n=e.call,r=e.lo,a=e.l,o=e.or;return function(e){return c(t(["state","animated"],[n(r(a(e),a("_value")),[o(r(s("animated"),a("_begin")),r(s("animated"),a("begin"))),s("animated")])]))}});U.args=H;var G=[["fn"],s("fn")],K=o.context(function(e){var t=e.func,n=e.call,r=e.lo,a=e.l,o=e.or;return function(e){return c(t(["state","animated"],[n(r(a(e),a("_value")),[o(r(s("animated"),a("_end")),r(s("animated"),a("end"))),s("animated")])]))}});K.args=G;var Q=[["a","op","b"],s("a"),o.context(function(e){var t=e.func,n=e.call,r=e.l,a=e.r,o=e.lo;return function(e,i){return c(t(["state","animated"],[n(o(n(r(a("op")),[e,i]),r("_value")),[a("state"),a("animated")])]))}}),o.context(function(e){var t=(e.func,e.call),n=e.l,r=e.r;e.lo;return function(e){return t(n(r("b")),[e])}})],X=o.context(function(e){var t=e.func,n=e.call,r=e.lo,a=e.l,o=e.r;e.w;return function(e,i,s){return c(t(["state","animated"],[n(r(a(i(e,s(e))),a("_value")),[o("state"),o("animated")])]))}});X.args=Q;var Z=[["a","b"],s("a"),o.context(function(e){var t=e.func,n=e.call,r=e.l,a=e.r,o=e.lo;return function(e){return c(t(["state","animated"],[n(o(n(r(a("b")),[e]),r("_value")),[a("state"),a("animated")])]))}})],$=function(e,t){return X(e,M,t)};$.args=Z;var ee=[["a","b"],s("a"),o.context(function(e){var t=e.func,n=e.call,r=e.l,a=e.r,o=e.lo;return function(e){return c(t(["state","animated"],[n(o(n(r(a("b")),[e]),r("_value")),[a("state"),a("animated")])]))}})],te=function(e,t){return X(e,I,t)};te.args=ee;var ne=[["ary"],s("ary")],re=o.context(function(e){var t=e.func,n=e.w,r=e.l,a=e.for_of,o=e.add,i=e.r,s=e.call,u=e.or,l=e.lo;return function(e){return c(t(["state","animated"],[n("s",r("")),a(e,["i","fn"],[n("s",o(i("s"),s(u(l(i("fn"),r("_value")),i("fn")),[i("state"),i("animated")])))]),i("s")]))}});re.args=ne;var ae=function(e){return o.context(function(t){var n=t.func,r=t.w,a=t.l,o=t.for_of,i=t.add,s=t.call,u=t.or,l=t.lo,f=t.r,p=t.not_last;return function(t){return re([re([d(e),d("(")]),c(n(["state","animated"],[r("s",a("")),o(t,["i","fn"],[r("s",i(f("s"),s(u(l(f("fn"),a("_value")),f("fn")),[f("state"),f("animated")]))),r("s",i(f("s"),p(a(", "),a(""))))]),f("s")])),d(")")])}})},oe=["translate","translatex","translatey","translatez","translate3d","rotate","rotatex","rotatey","rotatez","rotate3d","scale","scalex","scaley","scalez","scale3d"].map(function(e){var t=ae(e);return t.args=[["ary"],s("ary")],t}),ie=oe[0],se=oe[1],ue=oe[2],ce=oe[3],le=oe[4],fe=oe[5],pe=oe[6],de=oe[7],me=oe[8],he=oe[9],ve=oe[10],xe=oe[11],ye=oe[12],ge=oe[13],be=oe[14],ke=[["o"],s("o")],_e=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.st,o=e.r,i=e.call,s=e.or,u=e.lo,c=e.l,l=e.w,f=e.branch;return function(e){return t({main:n(["element","state","animated"],[r(e,["key","value"],[f(u(o("value"),c("_value")),[a(o("element"),o("key"),i(o("value"),[u(o("element"),o("key")),o("state"),o("animated")]))],[f(i(o("value"),[u(o("element"),o("key")),o("state"),o("animated")]),[])])]),o("element")]),store:n(["state","element","animated"],[l("state",s(o("state"),c({}))),r(e,["key","value"],[a(o("state"),o("key"),i(u(o("value"),c("store")),[u(o("state"),o("key")),u(o("element"),o("key")),o("animated")]))]),o("state")]),restore:n(["element","state","animated"],[r(e,["key","value"],[f(u(o("value"),c("_value")),[a(o("element"),o("key"),i(u(o("value"),c("restore")),[u(o("element"),o("key")),u(o("state"),o("key")),o("animated")]))],[i(u(o("value"),c("restore")),[u(o("element"),o("key")),u(o("state"),o("key")),o("animated")])])]),o("element")])})}});_e.args=ke;var we=[["styles"],s("styles")],Oe=function(e){return _e({style:_e(e)})};Oe.args=we;var Ee=[["o"],s("o")],Ae=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.st,o=e.r,i=e.call,s=e.or,u=e.lo,c=e.l,l=e.w;return function(e){return t({main:n(["element","state","animated"],[r(e,["key","value"],[l("_begin",s(u(o("animated"),c("_begin")),u(o("animated"),c("begin")))),a(o("animated"),c("_begin"),u(o("_begin"),o("key"))),l("_end",s(u(o("animated"),c("_end")),u(o("animated"),c("end")))),a(o("animated"),c("_end"),u(o("_end"),o("key"))),i(o("value"),[u(u(u(o("animated"),c("animated")),o("key")),c("element")),u(o("state"),o("key")),o("animated")]),a(o("animated"),c("_begin"),o("_begin")),a(o("animated"),c("_end"),o("_end"))]),o("element")]),store:n(["state","element","animated"],[l("state",s(o("state"),c({}))),r(e,["key","value"],[a(o("state"),o("key"),i(u(o("value"),c("store")),[u(o("state"),o("key")),u(u(u(o("animated"),c("animated")),o("key")),c("element")),o("animated")]))]),o("state")]),restore:n(["element","state","animated"],[r(e,["key","value"],[i(u(o("value"),c("restore")),[u(u(u(o("animated"),c("animated")),o("key")),c("element")),u(o("state"),o("key")),o("animated")])]),o("element")])})}});Ae.args=Ee;var Se=[["o"],s("o")],je=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.st,o=e.r,i=e.call,s=e.or,u=e.lo,c=e.l,l=e.w,f=e.branch,p=e.lt,d=e.add,m=e.loop;return function(e){return t({main:n(["element","state","animated"],[r(e,["key","value"],[l("_begin",s(u(o("animated"),c("_begin")),u(o("animated"),c("begin")))),a(o("animated"),c("_begin"),u(o("_begin"),o("key"))),l("_end",s(u(o("animated"),c("_end")),u(o("animated"),c("end")))),a(o("animated"),c("_end"),u(o("_end"),o("key"))),l("elements",u(u(u(o("animated"),c("animated")),o("key")),c("elements"))),l("state2",u(o("state"),o("key"))),l("i",c(0)),m(p(o("i"),u(o("elements"),c("length"))),[l("_begin2",s(u(o("animated"),c("_begin")),u(o("animated"),c("begin")))),a(o("animated"),c("_begin"),u(o("_begin2"),o("i"))),l("_end2",s(u(o("animated"),c("_end")),u(o("animated"),c("end")))),a(o("animated"),c("_end"),u(o("_end2"),o("i"))),i(o("value"),[u(o("elements"),o("i")),u(o("state2"),o("i")),o("animated")]),a(o("animated"),c("_begin"),o("_begin2")),a(o("animated"),c("_end"),o("_end2")),l("i",d(o("i"),c(1)))]),f(o("i"),[]),a(o("animated"),c("_begin"),o("_begin")),a(o("animated"),c("_end"),o("_end"))]),o("element")]),store:n(["state","element","animated"],[l("state",s(o("state"),c({}))),r(e,["key","value"],[l("elements",u(u(u(o("animated"),c("animated")),o("key")),c("elements"))),a(o("state"),o("key"),s(u(o("state"),o("key")),c([]))),l("state2",u(o("state"),o("key"))),l("i",c(0)),m(p(o("i"),u(o("elements"),c("length"))),[a(o("state2"),o("i"),i(u(o("value"),c("store")),[u(o("state2"),o("i")),u(o("elements"),o("i")),o("animated")])),l("i",d(o("i"),c(1)))]),f(o("i"),[])]),o("state")]),restore:n(["element","state","animated"],[r(e,["key","value"],[l("elements",u(u(u(o("animated"),c("animated")),o("key")),c("elements"))),l("state2",u(o("state"),o("key"))),l("i",c(0)),m(p(o("i"),u(o("elements"),c("length"))),[i(u(o("value"),c("restore")),[u(o("elements"),o("i")),u(o("state2"),o("i")),o("animated")]),l("i",d(o("i"),c(1)))]),f(o("i"),[])]),o("element")])})}});je.args=Se;var Te=[["o"],s("o")],Ne=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.st,o=e.r,i=e.call,s=e.or,u=e.lo,c=e.l,l=e.w;return function(e){return t({main:n(["element","state","animated"],[r(e,["key","value"],[l("_begin",s(u(o("animated"),c("_begin")),u(o("animated"),c("begin")))),a(o("animated"),c("_begin"),u(o("_begin"),o("key"))),l("_end",s(u(o("animated"),c("_end")),u(o("animated"),c("end")))),a(o("animated"),c("_end"),u(o("_end"),o("key"))),i(o("value"),[o("element"),u(o("state"),o("key")),o("animated")]),a(o("animated"),c("_begin"),o("_begin")),a(o("animated"),c("_end"),o("_end"))]),o("element")]),store:n(["state","element","animated"],[r(e,["key","value"],[i(u(o("value"),c("store")),[o("state"),o("element"),o("animated")])]),o("state")]),restore:n(["element","state","animated"],[r(e,["key","value"],[i(u(o("value"),c("restore")),[o("element"),o("state"),o("animated")])]),o("element")])})}});Ne.args=Te,e.exports=a({value:c,union:f,constant:d,key:h,em:g,percent:b,deg:k,rad:_,px:w,rem:O,vh:E,vmax:A,vmin:S,vw:j,add:q,sub:M,mul:R,div:I,abs:C,mod:J,min:z,max:P,eq:B,ne:L,lt:W,lte:D,gt:V,gte:Y,begin:U,end:K,against:X,to:$,over:te,concat:re,translate:ie,translatex:se,translatey:ue,translatez:ce,translate3d:le,rotate:fe,rotatex:pe,rotatey:de,rotatez:me,rotate3d:he,scale:ve,scalex:xe,scaley:ye,scalez:ge,scale3d:be,properties:_e,style:Oe,styles:Oe,elements:Ae,elementArrays:je,object:Ne})},function(e,t,n){var r=n(1),a=n(2),o=a(r),i=n(3),s=r.r,u=[["fn"],s("fn")],c=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r;return function(e){return t({main:n(["element","state","animated"],[r(a(e),[o("element"),o("state"),o("animated")])]),copy:e.copy||e.methods&&e.methods.copy||n(["dest","src"],[o("src")])})}});c.args=u;var l=[["set"],s("set")],f=o.context(function(e){var t=e.methods,n=e.func,r=e.for_of,a=e.call,o=e.r,i=e.lo,s=e.w,u=e.l;e.branch,e.and;return function(e){return t({main:n(["element","state","animated"],[r(e,["key","value"],[s("state",a(o("value"),[o("element"),o("state"),o("animated")]))]),o("state")]),copy:n(["dest","src"],[r(e,["key","value"],[s("dest",a(i(o("value"),u("copy")),[o("dest"),o("src")]))]),o("dest")])})}});f.args=l;var p=["abs","add","sub","mul","div","mod","min","max","eq","ne","lt","lte","gt","gte"].map(o.context(function(e){var t=e.l,n=e.r;return function(e){return i[e](c,function(e){return t(e)},["element","state","animated"],[n("element"),n("state"),n("animated")])}})),d=p[0],m=p[1],h=p[2],v=p[3],x=p[4],y=p[5],g=p[6],b=p[7],k=p[8],_=p[9],w=p[10],O=p[11],E=p[12],A=p[13],S=[[]],j=o.context(function(e){var t=e.func,n=e.r;return function(){return c(t(["state"],[n("state")]))}});j.args=S;var T=[["c"],s("c")],N=o.context(function(e){var t=e.func,n=e.l;return function(e){return c(t([],[n(e)]))}});N.args=T;var q=[["key"],s("key")],M=o.context(function(e){var t=e.func,n=e.lo,r=e.r,a=e.l;return function(e){return c(t(["element"],[n(r("element"),a(e))]))}});M.args=q;var R=o.context(function(e){var t=e.methods,n=e.func,r=e.w,a=e.r,o=e.or,i=e.l,s=e.for_of,u=e.st,c=e.call,l=e.lo;return function(e,f){return t({main:n(["element","state","animated"],f),copy:n(["dest","src"],[r("dest",o(a("dest"),i({}))),s(e,["key","value"],[u(a("dest"),a("key"),c(l(a("value"),i("copy")),[l(a("dest"),a("key")),l(a("src"),a("key"))]))]),a("dest")])})}}),I=[["obj"],s("obj")],F=o.context(function(e){var t=(e.methods,e.func,e.w),n=e.r,r=e.or,a=e.l,o=e.for_of,i=e.st,s=e.call,u=e.lo;return function(e){return R(e,[t("state",r(n("state"),a({}))),o(e,["key","value"],[i(n("state"),n("key"),s(n("value"),[n("element"),u(n("state"),n("key")),n("animated")]))]),n("state")])}});F.args=I;var C=[["obj"],s("obj")],J=o.context(function(e){var t=(e.methods,e.func,e.w),n=e.r,r=e.or,a=e.l,o=e.for_of,i=e.st,s=e.call,u=e.lo,c=e.branch,l=e.ne,f=e.body;return function(e){return R(e,[t("state",r(n("state"),a({}))),t("rootElement",u(u(u(n("animated"),a("animated")),a("root")),a("element"))),o(e,["key","value"],[i(u(n("animated"),a("animated")),n("key"),r(u(u(n("animated"),a("animated")),n("key")),a({}))),c(l(n("key"),a("root")),[i(u(u(n("animated"),a("animated")),n("key")),a("element"),u(s(u(n("rootElement"),a("getElementsByClassName")),[n("key")]),a(0)))]),i(n("state"),n("key"),s(n("value"),[u(u(u(n("animated"),a("animated")),n("key")),a("element")),u(n("state"),n("key")),n("animated")])),f([])]),n("state")])}});J.args=C;var z=[["obj"],s("obj")],P=o.context(function(e){var t=e.methods,n=e.func,r=e.w,a=e.r,o=e.or,i=e.l,s=e.for_of,u=e.st,c=e.call,l=e.lo,f=e.branch,p=e.body,d=e.loop,m=e.lt,h=e.add;return function(e){return t({main:n(["element","state","animated"],[r("state",o(a("state"),i({}))),r("rootElement",l(l(l(a("animated"),i("animated")),i("root")),i("element"))),s(e,["key","value"],[u(l(a("animated"),i("animated")),a("key"),o(l(l(a("animated"),i("animated")),a("key")),i({}))),u(l(l(a("animated"),i("animated")),a("key")),i("elements"),o(l(l(l(a("animated"),i("animated")),a("key")),i("elements")),i([]))),u(l(l(l(a("animated"),i("animated")),a("key")),i("elements")),i("length"),i(0)),r("dest",l(l(l(a("animated"),i("animated")),a("key")),i("elements"))),r("src",c(l(a("rootElement"),i("getElementsByClassName")),[a("key")])),u(a("state"),a("key"),o(l(a("state"),a("key")),i([]))),r("state2",l(a("state"),a("key"))),r("i",i(0)),d(m(a("i"),l(a("src"),i("length"))),[c(l(a("dest"),i("push")),[l(a("src"),a("i"))]),u(a("state2"),a("i"),c(a("value"),[l(a("dest"),a("i")),l(a("state2"),a("i")),a("animated")])),r("i",h(a("i"),i(1)))]),f(a("i"),[]),p([])]),a("state")]),copy:n(["dest","src"],[r("dest",o(a("dest"),i({}))),s(e,["key","value"],[u(a("dest"),a("key"),o(l(a("dest"),a("key")),i([]))),r("dest2",l(a("dest"),a("key"))),r("src2",l(a("src"),a("key"))),r("i",i(0)),d(m(a("i"),l(a("src2"),i("length"))),[u(a("dest2"),a("i"),c(l(a("value"),i("copy")),[l(a("dest2"),a("i")),l(a("src2"),a("i"))])),r("i",h(a("i"),i(1)))]),f(a("i"),[]),p([])]),a("dest")])})}});P.args=z;var B=[["obj"],s("obj")],L=o.context(function(e){var t=(e.methods,e.func,e.w),n=e.r,r=e.or,a=e.l,o=e.for_of,i=e.st,s=e.call,u=e.lo;return function(e){return R(e,[t("state",r(n("state"),a({}))),o(e,["key","value"],[i(n("state"),n("key"),s(n("value"),[u(n("element"),n("key")),n("state"),n("animated")]))]),n("state")])}});L.args=B;var W=[["a","b"],s("a"),s("b")],D=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo;return function(e,s){return t({main:n(["element","state","animated"],[r(a(s),[r(a(e),[o("element"),o("state"),o("animated")]),o("state"),o("animated")])]),copy:n(["dest","src"],[r(i(a(s),a("copy")),[o("dest"),o("src")])])})}});D.args=W;var V={left:j(),top:j(),right:j(),bottom:j(),width:j(),height:j()},Y=[[]],H=o.context(function(e){var t=e.methods,n=e.func,r=e.w,a=e.call,o=e.lo,i=e.r,s=e.l,u=e.st,c=e.add,l=e.or,f=e.for_of;return function(){return t({main:n(["element","state"],[r("_rect",a(o(i("element"),s("getBoundingClientRect")),[])),r("_scrollLeft",o(i("element"),s("scrollLeft"))),r("_scrollTop",o(i("element"),s("scrollTop"))),r("rect",l(i("state"),s({}))),u(i("rect"),s("left"),c(o(i("_rect"),s("left")),i("_scrollLeft"))),u(i("rect"),s("top"),c(o(i("_rect"),s("top")),i("_scrollTop"))),u(i("rect"),s("right"),c(o(i("_rect"),s("right")),i("_scrollLeft"))),u(i("rect"),s("bottom"),c(o(i("_rect"),s("bottom")),i("_scrollTop"))),u(i("rect"),s("width"),o(i("_rect"),s("width"))),u(i("rect"),s("height"),o(i("_rect"),s("height"))),i("rect")]),copy:n(["dest","src"],[r("dest",l(i("dest"),s({}))),f(V,["key","value"],[u(i("dest"),i("key"),o(i("src"),i("key")))]),i("dest")])})}});H.args=Y;var U=[["fn","compare"],s("fn"),s("compare")],G=o.context(function(e){var t=e.methods,n=e.func,r=e.call,a=e.l,o=e.r,i=e.lo;return function(e,s){return t({main:n(["element","state","animated"],[r(a(e),[o("element"),o("state"),o("animated")])]),copy:n(["dest","src"],[r(i(i(a(e),a("methods")),a("copy")),[o("dest"),o("src")])]),should:n(["a","b"],[r(a(s),[o("a"),o("b")])])})}});G.args=U,e.exports=a({value:c,union:f,abs:d,add:m,sub:h,mul:v,div:x,mod:y,min:g,max:b,eq:k,ne:_,lt:w,lte:O,gt:E,gte:A,identity:j,constant:N,property:M,object:F,elements:J,elementArrays:P,properties:L,asElement:D,byElement:D,rect:H,should:G})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){var n=t.bus,a=t.loop,o=t.matcher;r(this,e),this.bus=n,this.loop=a,this.matcher=o,this.elements={},this.elementRefs={},this.change=n.bind("state:change",3),this.create=n.bind("element:create",3),this.update=n.bind("element:update",3),this.destroy=n.bind("element:destroy",2),this.onChildMutate=this.onChildMutate.bind(this),this.onClassMutate=this.onClassMutate.bind(this),this.childMutationObserver=new MutationObserver(this.onChildMutate),this.classMutationObserver=new MutationObserver(this.onClassMutate)}return e.prototype.createNode=function(e){this.matcher.match(e.className)&&(this.change(this.matcher.matchType(),this.matcher.matchId(),this.matcher.matchAnimation()),this.elements[this.matcher.matchId()]?(this.update(this.matcher.matchType(),this.matcher.matchId(),e),this.elementRefs[this.matcher.matchId()]+=1):(this.create(this.matcher.matchType(),this.matcher.matchId(),e),this.elementRefs[this.matcher.matchId()]=1),this.elements[this.matcher.matchId()]=e)},e.prototype.destroyNode=function(e){var t=this;if(this.matcher.match(e.className)){var n=this.matcher.matchType(),r=this.matcher.matchId();this.elementRefs[r]-=1,this.loop.soon().then(function(){0===t.elementRefs[r]&&(t.destroy(n,r),delete t.elements[r],delete t.elementRefs[r])})}},e.prototype.onChildMutate=function(e){for(var t=0,n=e.length;t<n;t++){for(var r=e[t],a=0,o=r.addedNodes.length;a<o;a++)this.createNode(r.addedNodes[a]);for(var i=0,s=r.removedNodes.length;i<s;i++)this.destroyNode(r.removedNodes[i])}},e.prototype.onClassMutate=function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];r.target.className!==r.oldValue&&this.matcher.match(r.target.className)&&this.change(this.matcher.matchType(),this.matcher.matchId(),this.matcher.matchAnimation())}},e.prototype.observe=function(e){this.childMutationObserver.observe(e,this.childMutationInitOptions),this.classMutationObserver.observe(e,this.classMutationInitOptions);for(var t in this.animations)for(var n=e.getElementsByClassName(t),r=0;r<n.length;r++)this.createNode(n[r])},e.prototype.disconnect=function(){this.childMutationObserver.disconnect(),this.classMutationObserver.disconnect()},a(e,[{key:"childMutationInitOptions",get:function(){return{childList:!0,subtree:!0}}},{key:"classMutationInitOptions",get:function(){return{attributes:!0,attributeOldValue:!0,attributeFilter:["class"],subtree:!0}}}]),e}();t.a=o},,,,,,,,,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=n(14),o=n.n(a),i=n(19),s=n.n(i),u=n(20),c=n.n(u),l=n(4),f=n(5),p=n(7),d=n(8),m=n(9),h=n(0),v=n(21);n.d(t,"animate",function(){return o.a}),n.d(t,"present",function(){return s.a}),n.d(t,"update",function(){return c.a});var x=function(){function e(t){var n=t.loop,a=void 0===n?h.a.main:n,o=t.animations;r(this,e),this.animations=o;var i=this.bus=new p.a,s={},u=this.matcher=new m.a;Object.keys(o).forEach(function(e){u.add(e,Object.keys(o[e])),s[e.split(" ")[0]]=o[e]});var c=new f.a(o),x=c.create,y=this.manager=new l.a(x,a);new d.a(y,i),this.innerObserver=new v.a({bus:i,loop:a,matcher:u})}return e.prototype.observe=function(e){this.innerObserver.observe(e)},e.prototype.disconnect=function(){this.innerObserver.disconnect()},e.prototype.getManager=function(){return this.manager},e.prototype.getAnimated=function(e){return this.manager.getAnimated(e)},e}();t.default=x}])});